{# Partial: Kandidaten-Liste fuer Titel-Zuweisung #}
<div class="bg-white rounded-xl border border-gray-200 overflow-hidden"
     hx-get="/partials/titel-zuweisung/kandidaten?page={{ page }}&per_page={{ per_page }}&city={{ city }}&status={{ status }}&search={{ search }}"
     hx-trigger="refreshList from:body"
     hx-target="#kandidaten-liste"
     hx-swap="innerHTML">

    {# ═══ Tabellen-Header ═══ #}
    <div class="px-6 py-3 bg-gray-50 border-b border-gray-200 flex items-center justify-between">
        <span class="text-sm font-medium text-gray-600">
            {{ total_count }} Kandidat{{ "en" if total_count != 1 else "" }}
            {% if status == "offen" %} — noch offen{% elif status == "zugewiesen" %} — Titel zugewiesen{% endif %}
            {% if city %} in {{ city }}{% endif %}
        </span>
        <div class="flex items-center gap-2">
            <span class="text-xs text-gray-400">Seite {{ page }} von {{ total_pages }}</span>
        </div>
    </div>

    {# ═══ Tabelle ═══ #}
    {% if candidates %}
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kandidat</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Position / Firma</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stadt</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Zugewiesene Titel</th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Aktion</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
            {% for candidate in candidates %}
            <tr class="hover:bg-blue-50/50 transition-colors cursor-pointer"
                onclick="openTitelModal('{{ candidate.id }}')">
                {# Name + Avatar #}
                <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                        <div class="flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center text-sm font-semibold
                                    {% if candidate.manual_job_titles and candidate.manual_job_titles | length > 0 %}bg-green-100 text-green-700{% else %}bg-gray-100 text-gray-500{% endif %}">
                            {{ (candidate.first_name or "?")[0] | upper }}{{ (candidate.last_name or "?")[0] | upper }}
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ candidate.full_name }}</p>
                            {% if candidate.email %}
                            <p class="text-xs text-gray-400">{{ candidate.email }}</p>
                            {% endif %}
                        </div>
                    </div>
                </td>

                {# Position / Firma #}
                <td class="px-6 py-4">
                    <p class="text-sm text-gray-900">{{ candidate.current_position or "—" }}</p>
                    {% if candidate.current_company %}
                    <p class="text-xs text-gray-400">{{ candidate.current_company }}</p>
                    {% endif %}
                </td>

                {# Stadt #}
                <td class="px-6 py-4">
                    <span class="text-sm text-gray-600">{{ candidate.hotlist_city or candidate.city or "—" }}</span>
                </td>

                {# Zugewiesene Titel #}
                <td class="px-6 py-4">
                    {% if candidate.manual_job_titles and candidate.manual_job_titles | length > 0 %}
                    <div class="flex flex-wrap gap-1">
                        {% for title in candidate.manual_job_titles %}
                        <span class="inline-flex items-center rounded-full bg-green-100 text-green-700 px-2.5 py-0.5 text-xs font-medium">
                            {{ title }}
                        </span>
                        {% endfor %}
                    </div>
                    {% elif candidate.hotlist_job_titles and candidate.hotlist_job_titles | length > 0 %}
                    <div class="flex flex-wrap gap-1">
                        {% for title in candidate.hotlist_job_titles %}
                        <span class="inline-flex items-center rounded-full bg-gray-100 text-gray-500 px-2.5 py-0.5 text-xs font-medium">
                            {{ title }}
                        </span>
                        {% endfor %}
                        <span class="text-xs text-amber-500 font-medium">(automatisch)</span>
                    </div>
                    {% else %}
                    <span class="inline-flex items-center rounded-full bg-amber-50 text-amber-600 px-2.5 py-0.5 text-xs font-medium">
                        Nicht zugewiesen
                    </span>
                    {% endif %}
                </td>

                {# Aktion #}
                <td class="px-6 py-4 text-center">
                    <button onclick="event.stopPropagation(); openTitelModal('{{ candidate.id }}')"
                            class="inline-flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-xs font-medium transition-colors
                                   {% if candidate.manual_job_titles and candidate.manual_job_titles | length > 0 %}
                                   bg-gray-100 text-gray-600 hover:bg-gray-200
                                   {% else %}
                                   bg-primary-50 text-primary-700 hover:bg-primary-100
                                   {% endif %}">
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                        {% if candidate.manual_job_titles and candidate.manual_job_titles | length > 0 %}
                        Bearbeiten
                        {% else %}
                        Zuweisen
                        {% endif %}
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {# ═══ Pagination ═══ #}
    {% if total_pages > 1 %}
    <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-50">
        <div class="text-sm text-gray-500">
            Zeige {{ ((page - 1) * per_page) + 1 }}–{{ [page * per_page, total_count] | min }} von {{ total_count }}
        </div>
        <div class="flex items-center gap-1">
            {% if page > 1 %}
            <button hx-get="/partials/titel-zuweisung/kandidaten?page={{ page - 1 }}&per_page={{ per_page }}&city={{ city }}&status={{ status }}&search={{ search }}"
                    hx-target="#kandidaten-liste" hx-swap="innerHTML"
                    class="rounded-lg px-3 py-1.5 text-sm font-medium text-gray-600 hover:bg-gray-200 transition-colors">
                Zurueck
            </button>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
            {% if p <= 3 or p > total_pages - 3 or (p >= page - 1 and p <= page + 1) %}
            <button hx-get="/partials/titel-zuweisung/kandidaten?page={{ p }}&per_page={{ per_page }}&city={{ city }}&status={{ status }}&search={{ search }}"
                    hx-target="#kandidaten-liste" hx-swap="innerHTML"
                    class="rounded-lg px-3 py-1.5 text-sm font-medium transition-colors
                           {% if p == page %}bg-primary-600 text-white{% else %}text-gray-600 hover:bg-gray-200{% endif %}">
                {{ p }}
            </button>
            {% elif p == 4 or p == total_pages - 3 %}
            <span class="px-2 text-gray-400">...</span>
            {% endif %}
            {% endfor %}

            {% if page < total_pages %}
            <button hx-get="/partials/titel-zuweisung/kandidaten?page={{ page + 1 }}&per_page={{ per_page }}&city={{ city }}&status={{ status }}&search={{ search }}"
                    hx-target="#kandidaten-liste" hx-swap="innerHTML"
                    class="rounded-lg px-3 py-1.5 text-sm font-medium text-gray-600 hover:bg-gray-200 transition-colors">
                Weiter
            </button>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% else %}
    {# Keine Kandidaten #}
    <div class="px-6 py-16 text-center">
        <svg class="mx-auto h-12 w-12 text-gray-300" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
        </svg>
        <h3 class="mt-3 text-sm font-semibold text-gray-700">Keine Kandidaten gefunden</h3>
        <p class="mt-1 text-sm text-gray-400">Versuche andere Filter oder entferne die Suche.</p>
    </div>
    {% endif %}
</div>
