{# Partial: Korrespondenz eines Unternehmens â€” Dark Theme #}

{% if correspondence and correspondence | length > 0 %}
<div style="display:flex; flex-direction:column; gap:10px;">
    {% for corr in correspondence %}
    <div style="display:flex; align-items:flex-start; gap:14px; padding:14px 18px; background:var(--pp-surface); border:1px solid var(--pp-border); border-radius:12px; transition:background 0.15s;"
         onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='var(--pp-surface)'">

        {# Direction Icon #}
        {% if corr.direction.value == 'outbound' %}
        <div style="width:32px; height:32px; border-radius:10px; flex-shrink:0;
                    background:var(--pp-accentSoft); display:flex; align-items:center; justify-content:center;"
             title="Ausgehend">
            <span style="font-size:14px;">ðŸ“¤</span>
        </div>
        {% else %}
        <div style="width:32px; height:32px; border-radius:10px; flex-shrink:0;
                    background:var(--pp-greenSoft); display:flex; align-items:center; justify-content:center;"
             title="Eingehend">
            <span style="font-size:14px;">ðŸ“¥</span>
        </div>
        {% endif %}

        {# Content #}
        <div style="flex:1; min-width:0;">
            <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                <span style="font-size:14px; font-weight:600; color:var(--pp-text); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:400px;">{{ corr.subject }}</span>

                {# Richtungs-Badge #}
                {% if corr.direction.value == 'outbound' %}
                <span style="font-size:11px; font-weight:600; color:var(--pp-accent); background:var(--pp-accentSoft); padding:2px 8px; border-radius:6px;">Ausgehend</span>
                {% else %}
                <span style="font-size:11px; font-weight:600; color:var(--pp-green); background:var(--pp-greenSoft); padding:2px 8px; border-radius:6px;">Eingehend</span>
                {% endif %}
            </div>

            {# Kontakt-Zeile #}
            {% if corr.contact %}
            <div style="display:flex; align-items:center; gap:6px; margin-top:5px;">
                <span style="font-size:12px; color:var(--pp-textDim);">ðŸ‘¤</span>
                <span style="font-size:12px; color:var(--pp-accent); font-weight:500;">{{ corr.contact.first_name }} {{ corr.contact.last_name }}</span>
                {% if corr.contact.email %}
                <span style="font-size:11px; color:var(--pp-textDim);">Â· {{ corr.contact.email }}</span>
                {% endif %}
            </div>
            {% else %}
            <div style="margin-top:5px;">
                <span style="font-size:11px; color:var(--pp-textDim); font-style:italic;">Kein Kontakt zugeordnet</span>
            </div>
            {% endif %}

            {# Body Preview #}
            {% if corr.body %}
            <p style="font-size:13px; color:var(--pp-textMuted); margin-top:5px; line-height:1.4; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">{{ corr.body }}</p>
            {% endif %}
        </div>

        {# Right: Timestamp + Delete #}
        <div style="display:flex; flex-direction:column; align-items:flex-end; gap:8px; flex-shrink:0;">
            <span style="font-size:12px; color:var(--pp-textDim); white-space:nowrap;">{{ corr.sent_at | datetime }}</span>
            <button onclick="deleteCorrespondence('{{ corr.id }}')"
                    style="background:none; border:none; cursor:pointer; color:var(--pp-textDim); font-size:14px; padding:2px; transition:color 0.15s; line-height:1;"
                    onmouseover="this.style.color='var(--pp-red)'" onmouseout="this.style.color='var(--pp-textDim)'"
                    title="LÃ¶schen">âœ•</button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p style="font-size:13px; color:var(--pp-textDim);">Keine E-Mails vorhanden</p>
{% endif %}
