{# Tab "Nicht erreicht" â€” E-Mail gesendet, wartet auf Reaktion #}

{% if groups and groups | length > 0 %}
<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
    <span style="font-size:22px;font-weight:700;color:var(--pp-text);">{{ total }}</span>
    <span style="font-size:13px;color:var(--pp-textMuted);">Leads mit gesendeter E-Mail</span>
</div>

{% for group in groups %}
<div style="background:var(--pp-surface);border:1px solid var(--pp-border);border-radius:10px;margin-bottom:10px;overflow:hidden;">
    {# Firmen-Header #}
    <div style="padding:12px 16px;background:var(--pp-bg);border-bottom:1px solid var(--pp-border);display:flex;align-items:center;justify-content:space-between;cursor:pointer;"
         onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
        <div style="display:flex;align-items:center;gap:8px;">
            <span style="font-size:14px;font-weight:600;color:var(--pp-text);">{{ group.company_name }}</span>
            <span style="font-size:12px;color:var(--pp-textDim);">{{ group.city or '' }}</span>
            <span style="font-size:11px;color:var(--pp-textDim);">({{ group.jobs | length }} Stelle{{ 'n' if group.jobs | length > 1 else '' }})</span>
        </div>
        <svg style="width:14px;height:14px;color:var(--pp-textDim);" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/></svg>
    </div>
    {# Jobs #}
    <div>
        {% for job in group.jobs %}
        <div data-lead-id="{{ job.id }}" style="padding:12px 16px;border-bottom:1px solid var(--pp-border);display:flex;align-items:center;justify-content:space-between;cursor:pointer;transition:background .1s;"
             onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'"
             onclick="Alpine.$data(document.getElementById('akquise-root')).openCallScreen('{{ job.id }}')">
            <div style="display:flex;align-items:center;gap:10px;">
                <span style="display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;background:rgba(96,165,250,0.15);color:#60a5fa;">{{ job.akquise_status }}</span>
                <span style="font-size:13px;font-weight:500;color:var(--pp-text);">{{ job.position }}</span>
            </div>
            <div style="display:flex;align-items:center;gap:12px;">
                {% if job.email_sent_at %}
                {% set days_since = job.days_since_email or 0 %}
                <span style="font-size:11px;font-weight:500;{% if days_since < 3 %}color:var(--pp-green);{% elif days_since < 7 %}color:var(--pp-orange);{% else %}color:var(--pp-red);{% endif %}">
                    {{ days_since }} Tag{{ 'e' if days_since != 1 else '' }} seit E-Mail
                </span>
                {% endif %}
                {% if job.days_since_email and job.days_since_email >= 5 and job.akquise_status == 'email_gesendet' %}
                <button onclick="event.stopPropagation(); Alpine.$data(document.getElementById('akquise-root')).openEmailModal('{{ job.id }}', '{{ job.contact_id or '' }}')"
                        style="padding:4px 10px;background:var(--pp-accentSoft);border:1px solid rgba(59,130,246,0.3);border-radius:6px;color:var(--pp-accent);font-size:11px;font-weight:600;cursor:pointer;">
                    Follow-up
                </button>
                {% endif %}
                {% if job.days_since_email and job.days_since_email >= 14 and job.akquise_status == 'email_followup' %}
                <button onclick="event.stopPropagation(); Alpine.$data(document.getElementById('akquise-root')).openEmailModal('{{ job.id }}', '{{ job.contact_id or '' }}')"
                        style="padding:4px 10px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:6px;color:var(--pp-red);font-size:11px;font-weight:600;cursor:pointer;">
                    Break-up
                </button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endfor %}

{% if pages > 1 %}
{% include 'partials/akquise/pagination.html' %}
{% endif %}

{% else %}
<div style="text-align:center;padding:60px 0;">
    <p style="font-size:15px;font-weight:500;color:var(--pp-textMuted);margin:0;">Keine offenen E-Mail-Leads</p>
    <p style="font-size:13px;color:var(--pp-textDim);margin:6px 0 0;">Leads mit gesendeter E-Mail erscheinen hier</p>
</div>
{% endif %}
