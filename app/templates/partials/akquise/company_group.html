{# Firmen-Gruppe â€” Aufklappbare Lead-Gruppe nach Company #}
{# Erwartet: group = {company_name, city, company_status, company_id, jobs: [{id, position, akquise_status, akquise_priority, ...}]} #}

{% set job_count = group.jobs | length %}

<div style="background:var(--pp-surface);border:1px solid var(--pp-border);border-radius:10px;margin-bottom:10px;overflow:hidden;">
    {# Firmen-Header #}
    <div style="padding:12px 16px;background:var(--pp-bg);border-bottom:1px solid var(--pp-border);display:flex;align-items:center;justify-content:space-between;cursor:pointer;"
         onclick="var c=this.nextElementSibling;c.style.display=c.style.display==='none'?'block':'none';this.querySelector('.chevron').style.transform=c.style.display==='none'?'':'rotate(180deg)'">
        <div style="display:flex;align-items:center;gap:8px;">
            <span style="font-size:14px;font-weight:600;color:var(--pp-text);">{{ group.company_name }}</span>
            <span style="font-size:12px;color:var(--pp-textDim);">{{ group.city or '' }}</span>
            <span style="font-size:11px;color:var(--pp-textDim);">({{ job_count }} Stelle{{ 'n' if job_count > 1 else '' }})</span>
            {% if group.company_status == 'blacklist' %}
            <span style="padding:1px 8px;border-radius:4px;font-size:10px;font-weight:700;background:rgba(239,68,68,0.15);color:var(--pp-red);">BLACKLIST</span>
            {% elif group.company_status == 'customer' %}
            <span style="padding:1px 8px;border-radius:4px;font-size:10px;font-weight:700;background:rgba(34,197,94,0.15);color:var(--pp-green);">BESTANDSKUNDE</span>
            {% endif %}
        </div>
        <svg class="chevron" style="width:14px;height:14px;color:var(--pp-textDim);transition:transform .15s;{% if job_count <= 3 %}transform:rotate(180deg);{% endif %}" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/></svg>
    </div>

    {# Jobs (aufgeklappt wenn <= 3) #}
    <div style="{% if job_count > 3 %}display:none;{% endif %}">
        {% for job in group.jobs %}
        {% set status_colors = {
            'neu': 'background:rgba(59,130,246,0.12);color:var(--pp-accent);',
            'angerufen': 'background:rgba(234,179,8,0.12);color:var(--pp-orange);',
            'kontaktiert': 'background:rgba(34,197,94,0.12);color:var(--pp-green);',
            'wiedervorlage': 'background:rgba(167,139,250,0.12);color:var(--pp-purple);',
            'email_gesendet': 'background:rgba(96,165,250,0.12);color:#60a5fa;',
            'email_followup': 'background:rgba(96,165,250,0.12);color:#60a5fa;',
            'qualifiziert': 'background:rgba(16,185,129,0.12);color:#10b981;',
            'stelle_erstellt': 'background:rgba(34,197,94,0.15);color:var(--pp-green);',
            'kontakt_fehlt': 'background:rgba(234,179,8,0.12);color:var(--pp-orange);',
        } %}
        <div data-lead-id="{{ job.id }}"
             style="padding:10px 16px;border-bottom:1px solid var(--pp-border);display:flex;align-items:center;justify-content:space-between;cursor:pointer;transition:background .08s;"
             onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'"
             onclick="Alpine.$data(document.querySelector('[x-data]')).openCallScreen('{{ job.id }}')">
            <div style="display:flex;align-items:center;gap:10px;">
                <span style="display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;{{ status_colors.get(job.akquise_status, 'background:var(--pp-surface3);color:var(--pp-textDim);') }}">
                    {{ job.akquise_status or 'neu' }}
                </span>
                <span style="font-size:13px;font-weight:500;color:var(--pp-text);">{{ job.position }}</span>
                {% if job.city %}
                <span style="font-size:11px;color:var(--pp-textDim);">{{ job.city }}</span>
                {% endif %}
            </div>
            <div style="display:flex;align-items:center;gap:10px;">
                <span style="font-size:11px;color:var(--pp-textDim);">Prio {{ job.akquise_priority or '-' }}</span>
                <svg style="width:16px;height:16px;color:var(--pp-green);" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/></svg>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
