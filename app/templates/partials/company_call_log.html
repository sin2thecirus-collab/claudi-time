{# Partial: Anruf-Protokoll eines Unternehmens ‚Äî Dark Theme #}

{% if call_notes and call_notes | length > 0 %}
<div style="display:flex; flex-direction:column; gap:10px;">
    {% for note in call_notes %}
    <div x-data="{ open: false }"
         style="padding:16px 18px; border-radius:12px; background:var(--pp-surface); border:1px solid var(--pp-border); transition:all 0.15s;">
        <div style="display:flex; align-items:flex-start; gap:12px;">
            {# Direction Icon #}
            <div style="width:38px; height:38px; border-radius:10px; flex-shrink:0;
                        background:{% if note.direction and note.direction.value == 'inbound' %}var(--pp-greenSoft){% else %}var(--pp-accentSoft){% endif %};
                        display:flex; align-items:center; justify-content:center; font-size:17px;">
                {% if note.direction and note.direction.value == 'inbound' %}üì•{% else %}üì§{% endif %}
            </div>

            {# Content #}
            <div style="flex:1; min-width:0;">
                <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                    <span style="font-size:15px; font-weight:600; color:var(--pp-text);">
                        {% if note.contact %}{{ note.contact.first_name }} {{ note.contact.last_name }}{% else %}Unbekannt{% endif %}
                    </span>
                    <span style="display:inline-flex; align-items:center; gap:5px; padding:3px 10px; border-radius:7px; font-size:13px; font-weight:600;
                                 color:{% if note.direction and note.direction.value == 'inbound' %}var(--pp-green){% else %}var(--pp-accent){% endif %};
                                 background:{% if note.direction and note.direction.value == 'inbound' %}var(--pp-greenSoft){% else %}var(--pp-accentSoft){% endif %};">
                        {% if note.direction and note.direction.value == 'inbound' %}Eingehend{% else %}Ausgehend{% endif %}
                    </span>
                </div>
                <div style="display:flex; gap:14px; margin-top:5px; font-size:13px; color:var(--pp-textDim);">
                    {% if note.called_at %}
                    <span>üìÖ {{ note.called_at.strftime('%d.%m.%Y') }}</span>
                    <span>üïê {{ note.called_at.strftime('%H:%M') }}</span>
                    {% endif %}
                    {% if note.duration_minutes %}
                    <span>‚è± {{ note.duration_minutes }} Min</span>
                    {% endif %}
                </div>
                {# Expanded notes #}
                <template x-if="open">
                    <div style="font-size:14px; color:var(--pp-textMuted); margin-top:10px; line-height:1.5; padding:10px 12px; background:var(--pp-bg); border-radius:10px;">
                        {% if note.summary %}{{ note.summary }}{% elif note.raw_notes %}{{ note.raw_notes }}{% else %}Keine Notizen{% endif %}
                        <div style="margin-top:10px; display:flex; gap:8px;">
                            {% if note.call_type %}
                            <span style="font-size:12px; color:var(--pp-textDim); background:var(--pp-surfaceHover); padding:2px 8px; border-radius:5px;">{{ note.call_type.value | replace('_', ' ') | title }}</span>
                            {% endif %}
                            <button onclick="deleteCompanyCallNote('{{ note.id }}')"
                                    style="font-size:12px; color:var(--pp-red); background:var(--pp-redSoft); padding:2px 8px; border-radius:5px; border:none; cursor:pointer; font-family:var(--pp-ff);">
                                üóë L√∂schen
                            </button>
                        </div>
                    </div>
                </template>
            </div>

            {# Expand Button #}
            <button @click="open = !open" style="background:none; border:none; color:var(--pp-textDim); cursor:pointer; font-size:18px; padding:0 4px; transition:transform 0.2s;"
                    :style="open ? 'transform:rotate(180deg)' : 'transform:rotate(0)'">‚åÑ</button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p style="font-size:13px; color:var(--pp-textDim);">Keine Anrufe protokolliert</p>
{% endif %}
