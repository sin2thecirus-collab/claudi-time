{% if calls|length == 0 %}
{# ── Empty State ── #}
<div style="text-align: center; padding: 80px 20px;">
    <div style="width: 64px; height: 64px; border-radius: 50%; background: rgba(52,211,153,0.1); display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
        <svg style="width: 28px; height: 28px; color: var(--pp-green);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
        </svg>
    </div>
    <h3 style="font-size: 18px; font-weight: 700; color: var(--pp-text); margin: 0 0 8px;">
        Keine unzugeordneten Gespräche
    </h3>
    <p style="font-size: 14px; color: var(--pp-textMuted); max-width: 400px; margin: 0 auto;">
        Alle Anrufe wurden erfolgreich zugeordnet oder es sind noch keine Transkriptionen eingegangen.
    </p>
</div>

{% else %}

{# ── Call Cards ── #}
{% for call in calls %}
<div class="gc-call-card" x-data="{ showTranscript: false }" style="animation-delay: {{ loop.index0 * 0.05 }}s;">

    {# Row 1: Phone + Date #}
    <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 10px;">
            {# Phone Icon #}
            <div style="width: 36px; height: 36px; border-radius: 10px; background: rgba(79,140,255,0.1); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <svg style="width: 16px; height: 16px; color: var(--pp-accent);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                </svg>
            </div>
            {# Phone number #}
            <span style="font-size: 16px; font-weight: 700; color: var(--pp-text);">
                {{ call.phone_number or 'Unbekannte Nummer' }}
            </span>
        </div>
        {# Date #}
        <span style="font-size: 13px; color: var(--pp-textMuted); font-weight: 500;">
            {% if call.call_date %}
                {{ call.call_date.strftime('%d.%m.%Y, %H:%M Uhr') }}
            {% elif call.created_at %}
                {{ call.created_at.strftime('%d.%m.%Y, %H:%M Uhr') }}
            {% endif %}
        </span>
    </div>

    {# Row 2: Direction Badge + Duration + Topic #}
    <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px; flex-wrap: wrap;">
        {% if call.direction == 'inbound' %}
        <span class="gc-badge gc-badge-inbound">
            <svg style="width: 12px; height: 12px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5m0 0l7-7m-7 7l7 7"/></svg>
            Eingehend
        </span>
        {% else %}
        <span class="gc-badge gc-badge-outbound">
            <svg style="width: 12px; height: 12px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14m0 0l-7-7m7 7l-7 7"/></svg>
            Ausgehend
        </span>
        {% endif %}

        {% if call.duration_seconds %}
        <span style="font-size: 12.5px; color: var(--pp-textDim);">
            {{ (call.duration_seconds // 60) }}:{{ '%02d' % (call.duration_seconds % 60) }} Min
        </span>
        {% endif %}

        {% if call.recording_topic %}
        <span style="font-size: 12.5px; color: var(--pp-textDim);">
            &bull; {{ call.recording_topic[:60] }}{% if call.recording_topic|length > 60 %}...{% endif %}
        </span>
        {% endif %}
    </div>

    {# Block: GPT Summary (ALWAYS visible, most important!) #}
    {% if call.call_summary %}
    <div style="margin-top: 14px; padding: 12px 16px; background: var(--pp-bg); border-radius: 10px; border: 1px solid var(--pp-border);">
        <p style="font-size: 14px; color: var(--pp-text); line-height: 1.55; margin: 0;">
            {{ call.call_summary }}
        </p>
    </div>
    {% endif %}

    {# Badges: Extracted fields (if available) #}
    {% if call.extracted_data %}
    <div style="display: flex; gap: 6px; margin-top: 10px; flex-wrap: wrap;">
        {% if call.extracted_data.desired_positions %}
            {% for pos in call.extracted_data.desired_positions[:3] %}
            <span class="gc-badge gc-badge-field">{{ pos }}</span>
            {% endfor %}
        {% endif %}
        {% if call.extracted_data.erp_main %}
        <span class="gc-badge gc-badge-field">{{ call.extracted_data.erp_main }}</span>
        {% endif %}
        {% if call.extracted_data.salary %}
        <span class="gc-badge gc-badge-field">{{ call.extracted_data.salary }}</span>
        {% endif %}
        {% if call.extracted_data.notice_period %}
        <span class="gc-badge gc-badge-field">{{ call.extracted_data.notice_period }}</span>
        {% endif %}
        {% if call.extracted_data.home_office_days %}
        <span class="gc-badge gc-badge-field">{{ call.extracted_data.home_office_days }} Tage HO</span>
        {% endif %}
    </div>
    {% endif %}

    {# Transcript toggle #}
    {% if call.transcript %}
    <div>
        <span class="gc-transcript-toggle" @click="showTranscript = !showTranscript"
              x-text="showTranscript ? 'Transkript ausblenden' : 'Transkript anzeigen'">
        </span>
        <div x-show="showTranscript" x-collapse class="gc-transcript-body">
            {{ call.transcript }}
        </div>
    </div>
    {% endif %}

    {# Action Buttons #}
    <div style="display: flex; align-items: center; justify-content: flex-end; gap: 10px; margin-top: 16px; padding-top: 14px; border-top: 1px solid var(--pp-border);">
        <button type="button"
                class="gc-btn gc-btn-assign"
                onclick="openModal('/partials/gespraech-assign/{{ call.id }}')">
            <svg style="width: 14px; height: 14px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/>
            </svg>
            Zuordnen
        </button>
        <button type="button"
                class="gc-btn gc-btn-delete"
                hx-delete="/api/gespraeche/{{ call.id }}"
                hx-confirm="Dieses Gespräch wirklich löschen? Die Aktion kann nicht rückgängig gemacht werden."
                hx-target="closest .gc-call-card"
                hx-swap="outerHTML">
            <svg style="width: 14px; height: 14px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            Löschen
        </button>
    </div>

</div>
{% endfor %}

{% endif %}
