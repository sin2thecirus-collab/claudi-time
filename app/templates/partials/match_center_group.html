{# Gruppen-Detail: Jobs + Matches fuer eine Jobtitel+Stadt Kombination #}
{# Wird via HTMX in das Gruppen-Detail-Modal geladen #}

{% if jobs %}
<div class="space-y-4">
    {% for job in jobs %}
    <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <!-- Job-Header -->
        <div class="px-4 py-3 bg-gray-50 border-b border-gray-100">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="font-semibold text-gray-900 text-sm">{{ job.position }}</h3>
                    <p class="text-xs text-gray-500 mt-0.5">
                        {{ job.company_name }}{% if job.city %} &middot; {{ job.city }}{% endif %}
                        &middot; {{ job.match_count }} Match{{ 'es' if job.match_count != 1 else '' }}
                    </p>
                </div>
                <a href="/match-center/job/{{ job.job_id }}"
                   class="text-xs text-primary-600 hover:text-primary-700 font-medium transition-colors">
                    Detail &rarr;
                </a>
            </div>
        </div>

        <!-- Matches -->
        <div class="divide-y divide-gray-50">
            {% for m in job.matches %}
            <div class="flex items-center justify-between px-4 py-2.5 hover:bg-gray-50 transition-colors">
                <!-- Links: Score + Name -->
                <div class="flex items-center gap-3 min-w-0 flex-1">
                    <div class="flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold
                                {% if m.ai_score and m.ai_score >= 70 %}bg-green-100 text-green-700
                                {% elif m.ai_score and m.ai_score >= 40 %}bg-yellow-100 text-yellow-700
                                {% elif m.ai_score %}bg-gray-100 text-gray-600
                                {% else %}bg-gray-50 text-gray-400{% endif %}">
                        {% if m.ai_score %}{{ m.ai_score|int }}{% else %}&mdash;{% endif %}
                    </div>

                    <div class="min-w-0">
                        <div class="flex items-center gap-2">
                            {% if m.candidate_id %}
                            <span class="font-medium text-gray-900 text-sm truncate">{{ m.candidate_name }}</span>
                            {% else %}
                            <span class="font-medium text-gray-400 text-sm truncate">Geloeschter Kandidat</span>
                            {% endif %}

                            <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium
                                         {% if m.status == 'presented' %}bg-green-100 text-green-700
                                         {% elif m.status == 'rejected' %}bg-red-100 text-red-700
                                         {% elif m.status == 'placed' %}bg-purple-100 text-purple-700
                                         {% elif m.status == 'ai_checked' %}bg-blue-100 text-blue-700
                                         {% else %}bg-gray-100 text-gray-600{% endif %}">
                                {% if m.status == 'new' %}Neu
                                {% elif m.status == 'ai_checked' %}Bewertet
                                {% elif m.status == 'presented' %}Vorgestellt
                                {% elif m.status == 'rejected' %}Abgelehnt
                                {% elif m.status == 'placed' %}Vermittelt
                                {% else %}{{ m.status }}{% endif %}
                            </span>
                        </div>
                        <p class="text-xs text-gray-500 truncate">
                            {% if m.candidate_title %}{{ m.candidate_title }}{% endif %}
                            {% if m.candidate_city %} &middot; {{ m.candidate_city }}{% endif %}
                            {% if m.distance_km %} &middot; {{ m.distance_km }} km{% endif %}
                        </p>
                    </div>
                </div>

                <!-- Rechts: Aktionen -->
                <div class="flex items-center gap-1.5 flex-shrink-0 ml-3">
                    <button onclick="openCompareModal('{{ m.match_id }}')"
                            class="text-xs px-2 py-1 rounded-lg bg-primary-50 text-primary-700 hover:bg-primary-100 border border-primary-200 transition-colors font-medium">
                        Vergleich
                    </button>

                    {% if m.status not in ['presented', 'placed'] %}
                    <button hx-post="/api/match-center/status/{{ m.match_id }}?status=presented"
                            hx-target="#grp-status-{{ m.match_id }}"
                            hx-swap="outerHTML"
                            class="text-xs px-2 py-1 rounded-lg bg-green-50 text-green-700 hover:bg-green-100 border border-green-200 transition-colors font-medium">
                        Vorgestellt
                    </button>
                    {% endif %}

                    {% if m.status not in ['rejected', 'placed'] %}
                    <button hx-post="/api/match-center/status/{{ m.match_id }}?status=rejected"
                            hx-target="#grp-status-{{ m.match_id }}"
                            hx-swap="outerHTML"
                            class="text-xs px-2 py-1 rounded-lg bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 transition-colors font-medium">
                        Abgelehnt
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="py-6 text-center text-sm text-gray-400">
    Keine Jobs mit Matches in dieser Kombination gefunden.
</div>
{% endif %}
