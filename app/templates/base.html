<!DOCTYPE html>
<html lang="de" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Pulspoint{% endblock %}</title>

    <!-- CSRF Token fuer HTMX -->
    <meta name="csrf-token" content="">
    <script>
        // CSRF-Token aus Cookie lesen und in Meta-Tag + HTMX-Config setzen
        (function() {
            var match = document.cookie.match(/pp_csrf=([^;]+)/);
            if (match) {
                document.querySelector('meta[name="csrf-token"]').content = match[1];
            }
        })();
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd',
                            400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb',
                            700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script>
        // HTMX: CSRF-Token bei jedem Request als Header mitschicken
        document.addEventListener('htmx:configRequest', function(evt) {
            var match = document.cookie.match(/pp_csrf=([^;]+)/);
            if (match) {
                evt.detail.headers['X-CSRF-Token'] = match[1];
            }
        });
    </script>

    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --pp-bg: #09090B;
            --pp-surface: #131316;
            --pp-surfaceHover: #1A1A1F;
            --pp-surface3: #222228;
            --pp-border: #27272A;
            --pp-borderLight: #1F1F23;
            --pp-text: #FAFAFA;
            --pp-textMuted: #A1A1AA;
            --pp-textDim: #71717A;
            --pp-text4: #52525B;
            --pp-accent: #3B82F6;
            --pp-accentSoft: rgba(59,130,246,0.10);
            --pp-accentGlow: rgba(59,130,246,0.25);
            --pp-green: #22C55E;
            --pp-greenSoft: rgba(34,197,94,0.08);
            --pp-orange: #EAB308;
            --pp-orangeSoft: rgba(234,179,8,0.08);
            --pp-red: #EF4444;
            --pp-redSoft: rgba(239,68,68,0.08);
            --pp-purple: #A78BFA;
            --pp-purpleSoft: rgba(167,139,250,0.12);
            --pp-ff: 'Inter', -apple-system, system-ui, sans-serif;
        }

        * { box-sizing: border-box; }
        [x-cloak] { display: none !important; }

        html {
            overflow-x: hidden;
        }

        body {
            background: var(--pp-bg);
            color: var(--pp-text);
            font-family: var(--pp-ff);
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
            padding: 0;
            zoom: 1.15;
            overflow-x: hidden;
        }

        /* Responsive Zoom: kleinere Screens bekommen weniger Zoom */
        @media (max-width: 1440px) {
            body { zoom: 1.1; }
        }
        @media (max-width: 1366px) {
            body { zoom: 1.05; }
        }
        @media (max-width: 1024px) {
            body { zoom: 1; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--pp-border); border-radius: 3px; }
        ::selection { background: var(--pp-accentGlow); }

        /* HTMX Loading */
        .htmx-request .htmx-indicator { display: inline-block; }
        .htmx-indicator { display: none; }

        /* Animations */
        @keyframes skeleton-pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-skeleton { animation: skeleton-pulse 2s cubic-bezier(0.4,0,0.6,1) infinite; }

        @keyframes toast-in { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes toast-out { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-100%); opacity: 0; } }
        .toast-enter { animation: toast-in 0.3s ease-out; }
        .toast-leave { animation: toast-out 0.3s ease-in forwards; }

        @keyframes modal-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-enter { animation: modal-in 0.2s ease-out; }

        @keyframes slideOverIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes slideOverOut { from { transform: translateX(0); } to { transform: translateX(100%); } }
        .quickadd-panel-enter { animation: slideOverIn 0.3s cubic-bezier(0.4,0,0.2,1) forwards; }
        .quickadd-panel-leave { animation: slideOverOut 0.25s cubic-bezier(0.4,0,0.2,1) forwards; }

        /* Dark Inputs */
        select option { background: var(--pp-surface); color: var(--pp-text); }

        /* Nav link active */
        .pp-nav-item { padding: 5px 10px; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; color: var(--pp-textDim); background: transparent; text-decoration: none; display: inline-flex; align-items: center; transition: all 0.1s; border: none; white-space: nowrap; font-family: var(--pp-ff); }
        .pp-nav-item:hover { color: var(--pp-textMuted); background: var(--pp-surfaceHover); }
        .pp-nav-item.active { color: var(--pp-text); }

        /* ═══════════════════════════════════════════════════ */
        /* ═══ GLOBAL DARK THEME — Tailwind Overrides ═══ */
        /* ═══════════════════════════════════════════════════ */

        /* Backgrounds */
        .bg-white { background: var(--pp-surface) !important; }
        .bg-gray-50 { background: var(--pp-bg) !important; }
        .bg-gray-100 { background: var(--pp-surfaceHover) !important; }
        .bg-gray-200 { background: var(--pp-surfaceHover) !important; }

        /* Text Colors */
        .text-gray-900 { color: var(--pp-text) !important; }
        .text-gray-800 { color: var(--pp-text) !important; }
        .text-gray-700 { color: var(--pp-text) !important; }
        .text-gray-600 { color: var(--pp-textMuted) !important; }
        .text-gray-500 { color: var(--pp-textMuted) !important; }
        .text-gray-400 { color: var(--pp-textDim) !important; }
        .text-gray-300 { color: var(--pp-textDim) !important; }

        /* Borders */
        .border-gray-200 { border-color: var(--pp-border) !important; }
        .border-gray-300 { border-color: var(--pp-border) !important; }
        .border-gray-100 { border-color: var(--pp-border) !important; }
        .divide-gray-200 > :not([hidden]) ~ :not([hidden]) { border-color: var(--pp-border) !important; }
        .divide-gray-100 > :not([hidden]) ~ :not([hidden]) { border-color: var(--pp-border) !important; }
        .ring-gray-900\/5 { --tw-ring-color: var(--pp-border) !important; }

        /* Hover states */
        .hover\:bg-gray-50:hover { background: var(--pp-surfaceHover) !important; }
        .hover\:bg-gray-100:hover { background: var(--pp-surfaceHover) !important; }
        .hover\:bg-gray-200:hover { background: var(--pp-surfaceHover) !important; }
        .hover\:text-gray-600:hover { color: var(--pp-text) !important; }
        .hover\:text-gray-500:hover { color: var(--pp-text) !important; }
        .hover\:text-gray-700:hover { color: var(--pp-text) !important; }
        .hover\:text-gray-900:hover { color: var(--pp-text) !important; }

        /* Form elements global dark */
        input[type="text"], input[type="email"], input[type="number"],
        input[type="tel"], input[type="date"], input[type="time"],
        input[type="search"], input[type="url"], input[type="password"],
        textarea, select {
            background: var(--pp-bg) !important;
            border-color: var(--pp-border) !important;
            color: var(--pp-text) !important;
        }
        input::placeholder, textarea::placeholder {
            color: var(--pp-textDim) !important;
        }
        input:focus, textarea:focus, select:focus {
            border-color: var(--pp-accent) !important;
            box-shadow: 0 0 0 3px rgba(79,140,255,0.15) !important;
            --tw-ring-color: var(--pp-accent) !important;
        }
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(0.7);
        }
        input[type="checkbox"] {
            background: var(--pp-bg) !important;
            border-color: var(--pp-borderLight) !important;
        }

        /* Shadows — darker for dark theme */
        .shadow-sm { box-shadow: 0 1px 3px rgba(0,0,0,0.3) !important; }
        .shadow { box-shadow: 0 2px 6px rgba(0,0,0,0.3) !important; }
        .shadow-lg { box-shadow: 0 8px 30px rgba(0,0,0,0.35) !important; }
        .shadow-xl { box-shadow: 0 12px 40px rgba(0,0,0,0.4) !important; }

        /* Primary button overrides */
        .bg-primary-600 { background: var(--pp-accent) !important; }
        .bg-primary-600:hover, .hover\:bg-primary-500:hover, .hover\:bg-primary-700:hover {
            background: #2563EB !important;
        }
        .bg-primary-50 { background: var(--pp-accentSoft) !important; }
        .bg-primary-100 { background: var(--pp-accentSoft) !important; }
        .text-primary-600 { color: var(--pp-accent) !important; }
        .text-primary-700 { color: var(--pp-accent) !important; }
        .text-primary-500 { color: var(--pp-accent) !important; }
        .focus\:ring-primary-500:focus { --tw-ring-color: var(--pp-accent) !important; }
        .focus\:ring-primary-300:focus { --tw-ring-color: rgba(79,140,255,0.3) !important; }
        .peer-checked\:bg-primary-600:is(.peer:checked ~ *) { background: var(--pp-accent) !important; }

        /* Status colors */
        .bg-green-50 { background: var(--pp-greenSoft) !important; }
        .bg-green-100 { background: var(--pp-greenSoft) !important; }
        .text-green-600 { color: var(--pp-green) !important; }
        .text-green-700 { color: var(--pp-green) !important; }
        .text-green-800 { color: var(--pp-green) !important; }
        .border-green-200 { border-color: rgba(52,211,153,0.27) !important; }

        .bg-red-50 { background: var(--pp-redSoft) !important; }
        .bg-red-100 { background: var(--pp-redSoft) !important; }
        .bg-sky-100 { background: var(--pp-accentSoft) !important; }
        .text-sky-700 { color: var(--pp-accent) !important; }
        .bg-emerald-100 { background: var(--pp-greenSoft) !important; }
        .text-emerald-700 { color: var(--pp-green) !important; }
        .text-red-500 { color: var(--pp-red) !important; }
        .text-red-600 { color: var(--pp-red) !important; }
        .text-red-700 { color: var(--pp-red) !important; }
        .hover\:text-red-500:hover { color: var(--pp-red) !important; }
        .hover\:bg-red-100:hover { background: var(--pp-redSoft) !important; }

        .bg-amber-50, .bg-yellow-50 { background: var(--pp-orangeSoft) !important; }
        .bg-amber-100, .bg-yellow-100 { background: var(--pp-orangeSoft) !important; }
        .text-amber-600, .text-yellow-600 { color: var(--pp-orange) !important; }
        .text-amber-700, .text-yellow-700 { color: var(--pp-orange) !important; }
        .text-amber-800, .text-yellow-800 { color: var(--pp-orange) !important; }
        .border-amber-200 { border-color: rgba(245,158,11,0.27) !important; }

        .bg-blue-50 { background: var(--pp-accentSoft) !important; }
        .bg-blue-100 { background: var(--pp-accentSoft) !important; }
        .text-blue-500 { color: var(--pp-accent) !important; }
        .text-blue-600 { color: var(--pp-accent) !important; }
        .text-blue-700 { color: var(--pp-accent) !important; }
        .text-blue-800 { color: var(--pp-accent) !important; }
        .border-blue-100 { border-color: rgba(79,140,255,0.2) !important; }

        .bg-purple-50, .bg-indigo-50 { background: var(--pp-purpleSoft) !important; }
        .bg-purple-100, .bg-indigo-100 { background: var(--pp-purpleSoft) !important; }
        .text-purple-600, .text-indigo-600 { color: var(--pp-purple) !important; }
        .text-purple-700, .text-indigo-700 { color: var(--pp-purple) !important; }

        /* Dashed borders (dropzones) */
        .border-dashed { border-color: var(--pp-border) !important; }
        .border-dashed:hover { border-color: var(--pp-accent) !important; }
        .border-primary-500 { border-color: var(--pp-accent) !important; }
        .border-primary-400 { border-color: var(--pp-accent) !important; }

        /* Modals */
        .bg-black\/50 { background: rgba(0,0,0,0.6) !important; }

        /* Skeleton loading animation for dark theme */
        .animate-skeleton { animation: skeletonPulse 1.5s ease-in-out infinite; }
        @keyframes skeletonPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.3; }
        }

        /* Tables in dark */
        th { color: var(--pp-textDim) !important; border-color: var(--pp-border) !important; }
        td { color: var(--pp-text) !important; border-color: var(--pp-border) !important; }
        thead { background: var(--pp-bg) !important; }

        /* Scrollbar dark */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--pp-bg); }
        ::-webkit-scrollbar-thumb { background: var(--pp-border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--pp-borderLight); }

        /* HR elements */
        hr { border-color: var(--pp-border) !important; }
        .border-t { border-color: var(--pp-border) !important; }
        .border-b { border-color: var(--pp-border) !important; }

        /* Cancel/secondary buttons */
        button.border-gray-300,
        .bg-white.border.border-gray-300 {
            background: var(--pp-surface) !important;
            border-color: var(--pp-border) !important;
            color: var(--pp-textMuted) !important;
        }
        .hover\:bg-gray-50:hover {
            background: var(--pp-surfaceHover) !important;
        }

        /* Ring overrides for badges */
        .ring-gray-500\/20, .ring-gray-600\/20 { --tw-ring-color: var(--pp-border) !important; }
        .ring-red-600\/20 { --tw-ring-color: rgba(239,68,68,0.25) !important; }
        .ring-orange-600\/20 { --tw-ring-color: rgba(245,158,11,0.25) !important; }
        .ring-amber-600\/20 { --tw-ring-color: rgba(245,158,11,0.25) !important; }
        .ring-green-600\/20 { --tw-ring-color: rgba(52,211,153,0.25) !important; }
        .ring-primary-600\/20 { --tw-ring-color: rgba(79,140,255,0.25) !important; }
        .ring-primary-200 { --tw-ring-color: rgba(79,140,255,0.25) !important; }
        .ring-purple-600\/20 { --tw-ring-color: rgba(167,139,250,0.25) !important; }
        .border-purple-200 { border-color: rgba(167,139,250,0.25) !important; }
        .border-red-200 { border-color: rgba(239,68,68,0.25) !important; }
        .border-blue-200 { border-color: rgba(79,140,255,0.25) !important; }
        .border-amber-200 { border-color: rgba(245,158,11,0.25) !important; }
        .border-red-300 { border-color: rgba(239,68,68,0.35) !important; }
        .text-amber-400 { color: var(--pp-orange) !important; }
        .text-red-600 { color: var(--pp-red) !important; }
        .text-green-500 { color: var(--pp-green) !important; }
        .bg-red-600 { background: var(--pp-red) !important; }
        .bg-gray-50\/50 { background: rgba(24,26,35,0.5) !important; }
        .divide-gray-200 > :not([hidden]) ~ :not([hidden]) { border-color: var(--pp-border) !important; }
        .divide-gray-100 > :not([hidden]) ~ :not([hidden]) { border-color: var(--pp-border) !important; }
        .hover\:bg-gray-50:hover { background: var(--pp-surfaceHover) !important; }
        .hover\:bg-white:hover { background: var(--pp-surfaceHover) !important; }
        .hover\:text-gray-600:hover { color: var(--pp-text) !important; }
        .hover\:bg-green-50:hover { background: var(--pp-greenSoft) !important; }
        .hover\:bg-primary-50\/30:hover { background: rgba(79,140,255,0.08) !important; }
        .hover\:bg-primary-100:hover { background: var(--pp-accentSoft) !important; }
        .hover\:border-primary-300:hover { border-color: rgba(79,140,255,0.4) !important; }
        .has-\[\:checked\]\:border-primary-500:has(:checked) { border-color: var(--pp-accent) !important; }
        .has-\[\:checked\]\:bg-primary-50:has(:checked) { background: var(--pp-accentSoft) !important; }

        /* Modal backdrop — darker for dark theme */
        .bg-gray-500.bg-opacity-75 {
            background: rgba(0,0,0,0.6) !important;
            backdrop-filter: blur(4px) !important;
        }

        /* Indigo variants → accent */
        .border-indigo-500 { border-color: var(--pp-accent) !important; }
        .text-indigo-700 { color: var(--pp-accent) !important; }
        .text-indigo-500 { color: var(--pp-accent) !important; }
        .bg-indigo-50 { background: var(--pp-accentSoft) !important; }
        .bg-indigo-500 { background: var(--pp-accent) !important; }

        /* Orange text/bg */
        .text-orange-700 { color: var(--pp-orange) !important; }
        .bg-orange-50 { background: var(--pp-orangeSoft) !important; }

        /* Red text/bg */
        .text-red-800 { color: var(--pp-red) !important; }
        .hover\:bg-red-50:hover { background: var(--pp-redSoft) !important; }
        .hover\:text-red-600:hover { color: var(--pp-red) !important; }
        .hover\:bg-red-50\/50:hover { background: var(--pp-redSoft) !important; }

        /* Links in dark theme */
        a.text-primary-600:hover, .hover\:text-primary-500:hover { color: #6CA8FF !important; }
        .hover\:text-primary-800:hover { color: var(--pp-accent) !important; }

        /* Emerald color */
        .text-emerald-500 { color: var(--pp-green) !important; }
        .text-emerald-600 { color: var(--pp-green) !important; }

        /* Hover bg for action buttons */
        .hover\:bg-gray-100:hover { background: var(--pp-surfaceHover) !important; }

        /* Purple text */
        .text-purple-700 { color: var(--pp-purple) !important; }
        .text-purple-500 { color: var(--pp-purple) !important; }

        /* Violet text */
        .text-violet-500 { color: var(--pp-purple) !important; }

        /* ═══ GLOBAL QUICK-ADD DARK THEME ═══ */
        /* Applies to all content loaded inside #quickadd-content */
        #quickadd-content {
            font-family: var(--pp-ff);
        }

        /* Labels */
        #quickadd-content label,
        #quickadd-content .block.text-xs {
            color: var(--pp-green) !important;
            font-size: 13px !important;
            font-weight: 600 !important;
        }

        /* Fieldset legends */
        #quickadd-content legend,
        #quickadd-content .text-sm.font-bold {
            color: var(--pp-text) !important;
        }
        #quickadd-content legend svg,
        #quickadd-content .text-sm.font-bold svg {
            color: var(--pp-textMuted) !important;
        }

        /* Inputs, textareas, selects */
        #quickadd-content input[type="text"],
        #quickadd-content input[type="email"],
        #quickadd-content input[type="number"],
        #quickadd-content input[type="tel"],
        #quickadd-content input[type="date"],
        #quickadd-content input[type="time"],
        #quickadd-content textarea,
        #quickadd-content select {
            background: var(--pp-surface) !important;
            border: 1px solid var(--pp-border) !important;
            color: var(--pp-text) !important;
            border-radius: 10px !important;
            font-family: var(--pp-ff) !important;
            font-size: 13px !important;
            padding: 10px 12px !important;
            box-shadow: none !important;
        }
        #quickadd-content input::placeholder,
        #quickadd-content textarea::placeholder {
            color: var(--pp-textDim) !important;
        }
        #quickadd-content input:focus,
        #quickadd-content textarea:focus,
        #quickadd-content select:focus {
            border-color: var(--pp-accent) !important;
            outline: none !important;
            box-shadow: 0 0 0 2px var(--pp-accentSoft) !important;
        }

        /* Calendar & time picker icons */
        #quickadd-content input[type="date"]::-webkit-calendar-picker-indicator,
        #quickadd-content input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(1) brightness(2);
            cursor: pointer;
            opacity: 0.7;
        }

        /* Select options */
        #quickadd-content select option {
            background: var(--pp-surface);
            color: var(--pp-text);
        }

        /* Dropdowns (search results etc.) */
        #quickadd-content .bg-white {
            background: var(--pp-surface) !important;
        }
        #quickadd-content .border-gray-200,
        #quickadd-content .border-gray-300 {
            border-color: var(--pp-border) !important;
        }
        #quickadd-content .shadow-lg {
            box-shadow: 0 8px 32px rgba(0,0,0,0.5) !important;
        }

        /* Hover bg in dropdowns */
        #quickadd-content .hover\:bg-gray-50:hover,
        #quickadd-content .hover\:bg-gray-100:hover {
            background: var(--pp-surfaceHover) !important;
        }

        /* Text colors */
        #quickadd-content .text-gray-700 { color: var(--pp-text) !important; }
        #quickadd-content .text-gray-800 { color: var(--pp-text) !important; }
        #quickadd-content .text-gray-600 { color: var(--pp-textMuted) !important; }
        #quickadd-content .text-gray-500 { color: var(--pp-textMuted) !important; }
        #quickadd-content .text-gray-400 { color: var(--pp-textDim) !important; }
        #quickadd-content .text-gray-300 { color: var(--pp-textDim) !important; }
        #quickadd-content .text-gray-900 { color: var(--pp-text) !important; }

        /* Background overrides */
        #quickadd-content .bg-gray-50 { background: var(--pp-bg) !important; }
        #quickadd-content .bg-gray-100 { background: var(--pp-surfaceHover) !important; }

        /* Border overrides */
        #quickadd-content .border-gray-100 { border-color: var(--pp-border) !important; }
        #quickadd-content .border-t.border-gray-200 { border-color: var(--pp-border) !important; }

        /* Divider lines (the "oder" divider) */
        #quickadd-content .h-px.bg-gray-200 { background: var(--pp-border) !important; }

        /* Primary/accent badges */
        #quickadd-content .bg-primary-50 { background: var(--pp-accentSoft) !important; }
        #quickadd-content .text-primary-700,
        #quickadd-content .text-primary-600 { color: var(--pp-accent) !important; }
        #quickadd-content .hover\:text-primary-700:hover { color: var(--pp-accent) !important; }

        /* Success banner (CV parsed) */
        #quickadd-content .bg-green-50 { background: var(--pp-greenSoft) !important; }
        #quickadd-content .border-green-200 { border-color: rgba(52,211,153,0.27) !important; }
        #quickadd-content .text-green-800 { color: var(--pp-green) !important; }
        #quickadd-content .text-green-600 { color: var(--pp-green) !important; }
        #quickadd-content .text-green-700 { color: var(--pp-green) !important; }
        #quickadd-content .bg-green-100 { background: var(--pp-greenSoft) !important; }

        /* Warning banner (Duplikat) */
        #quickadd-content .bg-amber-50 { background: var(--pp-orangeSoft) !important; }
        #quickadd-content .border-amber-200 { border-color: rgba(245,158,11,0.27) !important; }
        #quickadd-content .text-amber-800 { color: var(--pp-orange) !important; }
        #quickadd-content .text-amber-700 { color: var(--pp-orange) !important; }
        #quickadd-content .text-amber-600 { color: var(--pp-orange) !important; }
        #quickadd-content .text-amber-500 { color: rgba(245,158,11,0.7) !important; }
        #quickadd-content .bg-amber-100 { background: var(--pp-orangeSoft) !important; }

        /* Blue info cards (changes) */
        #quickadd-content .bg-blue-50 { background: var(--pp-accentSoft) !important; }
        #quickadd-content .border-blue-100 { border-color: rgba(79,140,255,0.2) !important; }
        #quickadd-content .text-blue-800 { color: var(--pp-accent) !important; }
        #quickadd-content .text-blue-700 { color: var(--pp-accent) !important; }
        #quickadd-content .text-blue-500 { color: var(--pp-accent) !important; }

        /* Red/green text in diffs */
        #quickadd-content .text-red-500 { color: var(--pp-red) !important; }

        /* Primary buttons */
        #quickadd-content .bg-primary-600 {
            background: var(--pp-accent) !important;
            border: none !important;
        }
        #quickadd-content .bg-primary-600:hover,
        #quickadd-content .hover\:bg-primary-700:hover {
            background: #2563EB !important;
        }

        /* Blue buttons (merge) */
        #quickadd-content .bg-blue-600 {
            background: var(--pp-accent) !important;
            border: none !important;
        }
        #quickadd-content .bg-blue-600:hover,
        #quickadd-content .hover\:bg-blue-700:hover {
            background: #2563EB !important;
        }

        /* Cancel/secondary buttons */
        #quickadd-content button.border-gray-300,
        #quickadd-content button.border.border-gray-300 {
            background: transparent !important;
            border: 1px solid var(--pp-border) !important;
            color: var(--pp-textMuted) !important;
        }
        #quickadd-content button.border-gray-300:hover {
            background: var(--pp-surfaceHover) !important;
            color: var(--pp-text) !important;
        }

        /* Bottom sticky bars */
        #quickadd-content .sticky.bottom-0.bg-white {
            background: var(--pp-bg) !important;
        }
        #quickadd-content .sticky.bottom-0 {
            background: var(--pp-bg) !important;
        }

        /* Border-top in button areas */
        #quickadd-content .border-t {
            border-color: var(--pp-border) !important;
        }

        /* Drag-Drop Zones (Kandidat CV Upload) */
        #quickadd-content .border-dashed {
            border-color: var(--pp-border) !important;
            background: var(--pp-surface) !important;
        }
        #quickadd-content .border-dashed:hover {
            border-color: var(--pp-borderLight) !important;
            background: var(--pp-surfaceHover) !important;
        }
        /* Drag-over active state */
        #quickadd-content .border-primary-400 {
            border-color: var(--pp-accent) !important;
        }
        #quickadd-content .bg-primary-100 {
            background: var(--pp-accentSoft) !important;
        }

        /* Icon box in dropzone */
        #quickadd-content .border.border-gray-200 {
            border-color: var(--pp-border) !important;
            background: var(--pp-bg) !important;
        }

        /* Upload spinner */
        #quickadd-content .border-b-2.border-primary-600 {
            border-bottom-color: var(--pp-accent) !important;
        }

        /* NEU badge in changes */
        #quickadd-content .bg-green-100.text-green-700 {
            background: var(--pp-greenSoft) !important;
            color: var(--pp-green) !important;
        }

        /* "Trotzdem neu anlegen" ghost link */
        #quickadd-content .text-xs.text-gray-400.hover\:text-gray-600:hover {
            color: var(--pp-textMuted) !important;
        }

        /* Bestehendes Profil section header */
        #quickadd-content .text-xs.font-bold.text-gray-500.uppercase {
            color: var(--pp-textDim) !important;
        }

        /* Language chips */
        #quickadd-content .text-sm.text-gray-700.bg-gray-50 {
            background: var(--pp-surface) !important;
            border: 1px solid var(--pp-border) !important;
            color: var(--pp-text) !important;
        }

        /* Work history, education, further education cards */
        #quickadd-content .bg-gray-50.rounded-lg.border.border-gray-100 {
            background: var(--pp-surface) !important;
            border-color: var(--pp-border) !important;
        }

        /* Fieldset spacing inherits fine */
        #quickadd-content fieldset { border: none; padding: 0; }
    </style>

    {% block head %}{% endblock %}
</head>
<body x-data="{ sidebarOpen: false }">
    <!-- ═══ TOP NAVIGATION BAR ═══ -->
    <nav style="display:flex;align-items:center;padding:0 16px;height:48px;border-bottom:1px solid var(--pp-border);background:var(--pp-bg);position:sticky;top:0;z-index:100;">
        <!-- Logo -->
        <a href="/" style="font-size:14px;font-weight:700;letter-spacing:-0.04em;text-decoration:none;color:var(--pp-text);margin-right:16px;white-space:nowrap;">Pulse<span style="color:var(--pp-accent);">Point</span></a>
        <div style="width:1px;height:20px;background:var(--pp-border);margin-right:12px;"></div>
        <!-- Desktop Nav Items -->
        <div class="hidden sm:flex" style="gap:1px;flex:1;">
            <a href="/" class="pp-nav-item {% if request.url.path == '/' %}active{% endif %}">Dashboard</a>
            <a href="/jobs" class="pp-nav-item {% if request.url.path == '/jobs' %}active{% endif %}">Jobs</a>
            <a href="/kandidaten" class="pp-nav-item {% if request.url.path.startswith('/kandidaten') %}active{% endif %}">Kandidaten</a>
            <a href="/unternehmen" class="pp-nav-item {% if request.url.path.startswith('/unternehmen') %}active{% endif %}">Unternehmen</a>
            <div class="relative" x-data="{ atsOpen: false }">
                <button @click="atsOpen = !atsOpen" class="pp-nav-item {% if request.url.path.startswith('/ats') %}active{% endif %}" style="gap:4px;">
                    ATS
                    <svg style="width:10px;height:10px;transition:transform .15s;" :style="atsOpen ? 'transform:rotate(180deg)' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/></svg>
                </button>
                <div x-show="atsOpen" @click.away="atsOpen = false" x-transition style="display:none;position:absolute;left:0;top:100%;margin-top:4px;width:160px;background:var(--pp-surface);border:1px solid var(--pp-border);border-radius:8px;padding:4px;z-index:50;box-shadow:0 12px 40px rgba(0,0,0,0.6);">
                    <a href="/ats" style="display:block;padding:6px 10px;border-radius:5px;color:var(--pp-textMuted);text-decoration:none;font-size:13px;font-weight:500;transition:all .08s;" onmouseover="this.style.background='var(--pp-surfaceHover)';this.style.color='var(--pp-text)'" onmouseout="this.style.background='transparent';this.style.color='var(--pp-textMuted)'">Pipeline</a>
                    <a href="/ats/todos/dashboard" style="display:block;padding:6px 10px;border-radius:5px;color:var(--pp-textMuted);text-decoration:none;font-size:13px;font-weight:500;transition:all .08s;" onmouseover="this.style.background='var(--pp-surfaceHover)';this.style.color='var(--pp-text)'" onmouseout="this.style.background='transparent';this.style.color='var(--pp-textMuted)'">Aufgaben</a>
                </div>
            </div>
            <a href="/hotlisten" class="pp-nav-item {% if request.url.path.startswith('/hotlisten') or request.url.path.startswith('/match-bereiche') or request.url.path.startswith('/deepmatch') %}active{% endif %}">Hotlisten</a>
            <a href="/match-center" class="pp-nav-item {% if request.url.path.startswith('/match-center') %}active{% endif %}">Match Center</a>
            <a href="/action-board" class="pp-nav-item {% if request.url.path == '/action-board' %}active{% endif %}">Action Board</a>
            <a href="/titel-zuweisung" class="pp-nav-item {% if request.url.path.startswith('/titel-zuweisung') %}active{% endif %}">Titel</a>
            <a href="/gespraeche" class="pp-nav-item {% if request.url.path == '/gespraeche' %}active{% endif %}">Gespräche</a>
            <a href="/emails" class="pp-nav-item {% if request.url.path == '/emails' %}active{% endif %}">Emails</a>
            <a href="/statistiken" class="pp-nav-item {% if request.url.path == '/statistiken' %}active{% endif %}">Statistiken</a>
            <a href="/einstellungen" class="pp-nav-item {% if request.url.path == '/einstellungen' %}active{% endif %}">Einstellungen</a>
        </div>

        <!-- Right: Search + Quick-Add + Status -->
        <div class="hidden sm:flex" style="align-items:center;gap:6px;margin-left:auto;">
            <!-- Global Search -->
            <div x-data="globalSearch()" @keydown.window.meta.k.prevent="$refs.searchInput.focus()" @keydown.window.ctrl.k.prevent="$refs.searchInput.focus()" style="position:relative;">
                <div @click="$refs.searchInput.focus()" style="display:flex;align-items:center;gap:6px;background:var(--pp-surfaceHover);border:1px solid var(--pp-border);border-radius:6px;padding:5px 10px;color:var(--pp-textDim);font-size:12px;cursor:text;transition:border-color .1s;min-width:200px;" :style="focused && 'border-color:var(--pp-accent);'">
                    <span style="font-size:13px;">&#128269;</span>
                    <input x-ref="searchInput" type="text" x-model="q" @focus="focused=true" @blur="setTimeout(()=>{focused=false;open=false},200)" @input.debounce.300ms="search()" placeholder="Suchen..." style="background:transparent!important;border:none!important;outline:none!important;color:var(--pp-text)!important;font-size:12px;width:100%;padding:0!important;box-shadow:none!important;font-family:var(--pp-ff);">
                    <span style="background:var(--pp-surface3);border:1px solid var(--pp-border);border-radius:4px;padding:0 5px;font-size:11px;font-family:var(--pp-ff);line-height:1.6;color:var(--pp-text4);white-space:nowrap;">&#8984;K</span>
                </div>
                <!-- Search Results Dropdown -->
                <div x-show="open && results" x-cloak x-transition style="position:absolute;right:0;top:100%;margin-top:6px;width:380px;background:var(--pp-surface);border:1px solid var(--pp-border);border-radius:8px;padding:6px;z-index:200;box-shadow:0 12px 40px rgba(0,0,0,0.6);max-height:420px;overflow-y:auto;">
                    <template x-if="loading">
                        <div style="padding:16px;text-align:center;color:var(--pp-textDim);font-size:12px;">Suche...</div>
                    </template>
                    <template x-if="!loading && noResults">
                        <div style="padding:16px;text-align:center;color:var(--pp-textDim);font-size:12px;">Keine Ergebnisse</div>
                    </template>
                    <template x-if="!loading && results && results.candidates && results.candidates.length > 0">
                        <div>
                            <div style="padding:4px 8px;font-size:10px;font-weight:600;color:var(--pp-text4);text-transform:uppercase;letter-spacing:0.05em;">Kandidaten</div>
                            <template x-for="r in results.candidates" :key="r.id">
                                <a :href="'/kandidaten/'+r.id" style="display:flex;align-items:center;gap:10px;padding:6px 8px;border-radius:5px;text-decoration:none;color:var(--pp-text);font-size:13px;transition:background .08s;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                                    <span style="width:24px;height:24px;border-radius:6px;background:var(--pp-accentSoft);color:var(--pp-accent);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;" x-text="r.name ? r.name.split(' ').map(n=>n[0]).join('').substring(0,2) : '?'"></span>
                                    <div style="flex:1;min-width:0;">
                                        <div style="font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" x-text="r.name"></div>
                                        <div style="font-size:11px;color:var(--pp-textDim);" x-text="[r.position, r.city].filter(Boolean).join(' · ')"></div>
                                    </div>
                                </a>
                            </template>
                        </div>
                    </template>
                    <template x-if="!loading && results && results.companies && results.companies.length > 0">
                        <div>
                            <div style="padding:4px 8px;font-size:10px;font-weight:600;color:var(--pp-text4);text-transform:uppercase;letter-spacing:0.05em;margin-top:4px;">Unternehmen</div>
                            <template x-for="r in results.companies" :key="r.id">
                                <a :href="'/unternehmen/'+r.id" style="display:flex;align-items:center;gap:10px;padding:6px 8px;border-radius:5px;text-decoration:none;color:var(--pp-text);font-size:13px;transition:background .08s;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                                    <span style="width:24px;height:24px;border-radius:6px;background:var(--pp-greenSoft);color:var(--pp-green);display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;">&#127970;</span>
                                    <div style="flex:1;min-width:0;">
                                        <div style="font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" x-text="r.name"></div>
                                        <div style="font-size:11px;color:var(--pp-textDim);" x-text="r.city || ''"></div>
                                    </div>
                                </a>
                            </template>
                        </div>
                    </template>
                    <template x-if="!loading && results && results.contacts && results.contacts.length > 0">
                        <div>
                            <div style="padding:4px 8px;font-size:10px;font-weight:600;color:var(--pp-text4);text-transform:uppercase;letter-spacing:0.05em;margin-top:4px;">Kontakte</div>
                            <template x-for="r in results.contacts" :key="r.id">
                                <a :href="'/unternehmen/'+r.company_id" style="display:flex;align-items:center;gap:10px;padding:6px 8px;border-radius:5px;text-decoration:none;color:var(--pp-text);font-size:13px;transition:background .08s;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                                    <span style="width:24px;height:24px;border-radius:6px;background:var(--pp-purpleSoft);color:var(--pp-purple);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;" x-text="r.name ? r.name.split(' ').map(n=>n[0]).join('').substring(0,2) : '?'"></span>
                                    <div style="flex:1;min-width:0;">
                                        <div style="font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" x-text="r.name"></div>
                                        <div style="font-size:11px;color:var(--pp-textDim);" x-text="[r.position, r.company].filter(Boolean).join(' · ')"></div>
                                    </div>
                                </a>
                            </template>
                        </div>
                    </template>
                    <template x-if="!loading && results && results.jobs && results.jobs.length > 0">
                        <div>
                            <div style="padding:4px 8px;font-size:10px;font-weight:600;color:var(--pp-text4);text-transform:uppercase;letter-spacing:0.05em;margin-top:4px;">Jobs</div>
                            <template x-for="r in results.jobs" :key="r.id">
                                <a :href="'/jobs/'+r.id" style="display:flex;align-items:center;gap:10px;padding:6px 8px;border-radius:5px;text-decoration:none;color:var(--pp-text);font-size:13px;transition:background .08s;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                                    <span style="width:24px;height:24px;border-radius:6px;background:var(--pp-orangeSoft);color:var(--pp-orange);display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;">&#128188;</span>
                                    <div style="flex:1;min-width:0;">
                                        <div style="font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" x-text="r.position"></div>
                                        <div style="font-size:11px;color:var(--pp-textDim);" x-text="[r.company, r.city].filter(Boolean).join(' · ')"></div>
                                    </div>
                                </a>
                            </template>
                        </div>
                    </template>
                    <template x-if="!loading && results && results.stellen && results.stellen.length > 0">
                        <div>
                            <div style="padding:4px 8px;font-size:10px;font-weight:600;color:var(--pp-text4);text-transform:uppercase;letter-spacing:0.05em;margin-top:4px;">Stellen</div>
                            <template x-for="r in results.stellen" :key="r.id">
                                <a :href="'/ats'" style="display:flex;align-items:center;gap:10px;padding:6px 8px;border-radius:5px;text-decoration:none;color:var(--pp-text);font-size:13px;transition:background .08s;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                                    <span style="width:24px;height:24px;border-radius:6px;background:var(--pp-redSoft);color:var(--pp-red);display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;">&#127919;</span>
                                    <div style="flex:1;min-width:0;">
                                        <div style="font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" x-text="r.title"></div>
                                        <div style="font-size:11px;color:var(--pp-textDim);" x-text="r.city || ''"></div>
                                    </div>
                                </a>
                            </template>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Quick-Add Button -->
            <div class="relative" x-data="{ quickAdd: false }">
                <button @click="quickAdd = !quickAdd" style="height:30px;padding:0 12px;border-radius:6px;background:var(--pp-accent);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;gap:4px;font-size:13px;font-weight:500;font-family:var(--pp-ff);transition:filter .1s;" title="Neu erstellen">
                    <svg style="width:14px;height:14px;" fill="currentColor" viewBox="0 0 20 20"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"/></svg>
                    Neu
                </button>
                <div x-show="quickAdd" @click.away="quickAdd = false" x-transition style="display:none;position:absolute;right:0;top:100%;margin-top:6px;width:200px;background:var(--pp-surface);border:1px solid var(--pp-border);border-radius:8px;padding:4px;z-index:50;box-shadow:0 12px 40px rgba(0,0,0,0.6);">
                    <div style="padding:4px 8px;font-size:10px;font-weight:600;color:var(--pp-text4);text-transform:uppercase;letter-spacing:0.05em;">Neu erstellen</div>
                    <button @click="quickAdd=false;openQuickAdd('kandidat')" style="width:100%;display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:5px;border:none;background:transparent;color:var(--pp-text);font-size:13px;font-weight:500;cursor:pointer;font-family:var(--pp-ff);transition:background .08s;text-align:left;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                        <span style="font-size:12px;">&#128100;</span> Kandidat
                    </button>
                    <button @click="quickAdd=false;openQuickAdd('unternehmen')" style="width:100%;display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:5px;border:none;background:transparent;color:var(--pp-text);font-size:13px;font-weight:500;cursor:pointer;font-family:var(--pp-ff);transition:background .08s;text-align:left;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                        <span style="font-size:12px;">&#127970;</span> Unternehmen
                    </button>
                    <div style="height:1px;background:var(--pp-border);margin:2px 6px;"></div>
                    <button @click="quickAdd=false;openQuickAdd('job')" style="width:100%;display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:5px;border:none;background:transparent;color:var(--pp-text);font-size:13px;font-weight:500;cursor:pointer;font-family:var(--pp-ff);transition:background .08s;text-align:left;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                        <span style="font-size:12px;">&#128188;</span> Job
                    </button>
                    <button @click="quickAdd=false;openQuickAdd('stelle')" style="width:100%;display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:5px;border:none;background:transparent;color:var(--pp-text);font-size:13px;font-weight:500;cursor:pointer;font-family:var(--pp-ff);transition:background .08s;text-align:left;" onmouseover="this.style.background='var(--pp-surfaceHover)'" onmouseout="this.style.background='transparent'">
                        <span style="font-size:12px;">&#127919;</span> Stelle
                    </button>
                </div>
            </div>

            <!-- System Status -->
            <div id="health-indicator"
                 hx-get="/api/health"
                 hx-trigger="load, every 30s"
                 hx-swap="innerHTML"
                 style="display:flex;align-items:center;gap:5px;padding:4px 10px;border-radius:6px;background:var(--pp-greenSoft);font-size:12px;font-weight:600;color:var(--pp-green);">
                <div style="width:6px;height:6px;border-radius:50%;background:var(--pp-green);"></div>
                <span>OK</span>
            </div>

            <!-- Logout -->
            <form method="POST" action="/logout" style="margin:0;">
                <button type="submit" title="Abmelden" style="width:30px;height:30px;border-radius:6px;background:transparent;border:none;color:var(--pp-text4);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .1s;" onmouseover="this.style.color='var(--pp-red)';this.style.background='var(--pp-redSoft)'" onmouseout="this.style.color='var(--pp-text4)';this.style.background='transparent'">
                    <svg style="width:15px;height:15px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </button>
            </form>
        </div>

        <!-- Mobile Menu Button -->
        <div class="flex items-center sm:hidden" style="margin-left:auto;">
            <button @click="sidebarOpen = !sidebarOpen" type="button" style="padding:6px;border-radius:6px;border:1px solid var(--pp-border);background:transparent;color:var(--pp-textMuted);cursor:pointer;">
                <svg x-show="!sidebarOpen" style="width:20px;height:20px;" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
                <svg x-show="sidebarOpen" style="width:20px;height:20px;display:none;" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>
    </nav>

    <!-- Mobile Navigation -->
    <div x-show="sidebarOpen" x-transition class="sm:hidden" style="display:none;background:var(--pp-surface);border-bottom:1px solid var(--pp-border);padding:8px;">
        <a href="/" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Dashboard</a>
        <a href="/jobs" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Jobs</a>
        <a href="/kandidaten" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Kandidaten</a>
        <a href="/unternehmen" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Unternehmen</a>
        <a href="/ats" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">ATS</a>
        <a href="/hotlisten" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Hotlisten</a>
        <a href="/match-center" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Match Center</a>
        <a href="/titel-zuweisung" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Titel</a>
        <a href="/gespraeche" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Gespräche</a>
        <a href="/emails" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Emails</a>
        <a href="/statistiken" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Statistiken</a>
        <a href="/einstellungen" style="display:block;padding:12px 16px;border-radius:10px;color:var(--pp-text);text-decoration:none;font-size:15px;font-weight:500;">Einstellungen</a>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" style="position:fixed;top:56px;right:16px;z-index:200;display:flex;flex-direction:column;gap:8px;pointer-events:none;"></div>

    <!-- Alert Banner Container -->
    <div id="alert-banner-container" hx-get="/api/alerts/active" hx-trigger="load, alertsChanged from:body" hx-swap="innerHTML"></div>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Modal Container -->
    <div id="modal-container"
         x-data="{ open: false }"
         @open-modal.window="open = true"
         @close-modal.window="open = false"
         @keydown.escape.window="open = false"
         x-show="open" x-cloak
         style="position:relative;z-index:150;">
        <div style="position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);"></div>
        <div style="position:fixed;inset:0;z-index:10;overflow-y:auto;" @click.self="open = false">
            <div style="display:flex;min-height:100%;align-items:center;justify-content:center;padding:20px;" @click.self="open = false">
                <div id="modal-content" @click.stop style="position:relative;background:var(--pp-surface);border:1px solid var(--pp-border);border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.5);width:100%;max-width:540px;overflow:hidden;">
                </div>
            </div>
        </div>
    </div>

    <!-- Quick-Add Slide-Over -->
    <div id="quickadd-overlay" style="position:fixed;inset:0;z-index:150;display:none;">
        <div id="quickadd-backdrop" style="position:absolute;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(4px);transition:opacity .3s;opacity:0;" onclick="closeQuickAdd()"></div>
        <div id="quickadd-panel" style="position:absolute;inset-block:0;right:0;width:100%;max-width:580px;background:var(--pp-surface);box-shadow:0 0 60px rgba(0,0,0,0.5);display:flex;flex-direction:column;overflow:hidden;" class="quickadd-panel-enter">
            <div id="quickadd-header" style="display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid var(--pp-border);flex-shrink:0;">
                <h2 id="quickadd-title" style="font-size:18px;font-weight:700;color:var(--pp-text);margin:0;"></h2>
                <button onclick="closeQuickAdd()" style="padding:8px;border-radius:8px;border:none;background:transparent;color:var(--pp-textDim);cursor:pointer;font-size:20px;transition:all .15s;" onmouseover="this.style.background='var(--pp-surfaceHover)';this.style.color='var(--pp-text)'" onmouseout="this.style.background='transparent';this.style.color='var(--pp-textDim)'">&times;</button>
            </div>
            <div id="quickadd-content" style="flex:1;overflow-y:auto;background:var(--pp-bg);">
                <div style="display:flex;align-items:center;justify-content:center;height:200px;">
                    <div style="width:28px;height:28px;border:2px solid var(--pp-accent);border-top-color:transparent;border-radius:50%;animation:spin .6s linear infinite;"></div>
                </div>
            </div>
        </div>
    </div>

    <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

    <!-- Global Scripts -->
    <script>
        // HTMX Konfiguration
        document.body.addEventListener('htmx:configRequest', function(evt) {
            evt.detail.headers['X-Request-ID'] = crypto.randomUUID();
        });

        document.body.addEventListener('htmx:responseError', function(evt) {
            var status = evt.detail.xhr.status;
            var message = 'Ein Fehler ist aufgetreten';
            if (status === 404) message = 'Ressource nicht gefunden';
            else if (status === 422) message = 'Validierungsfehler';
            else if (status === 429) message = 'Zu viele Anfragen - bitte warten';
            else if (status >= 500) message = 'Serverfehler - bitte spaeter erneut versuchen';
            showToast(message, 'error');
        });

        // Toast System (Dark Theme)
        function showToast(message, type, duration) {
            type = type || 'success';
            duration = duration || 5000;
            var container = document.getElementById('toast-container');
            var toast = document.createElement('div');

            var colors = {
                success: { bg: 'rgba(52,211,153,0.12)', text: '#34D399', border: 'rgba(52,211,153,0.27)', icon: '✓' },
                error:   { bg: 'rgba(239,68,68,0.12)', text: '#EF4444', border: 'rgba(239,68,68,0.27)', icon: '✕' },
                warning: { bg: 'rgba(245,158,11,0.12)', text: '#F59E0B', border: 'rgba(245,158,11,0.27)', icon: '⚠' },
                info:    { bg: 'rgba(59,130,246,0.12)', text: '#3B82F6', border: 'rgba(59,130,246,0.27)', icon: 'ℹ' }
            };
            var c = colors[type] || colors.info;

            toast.className = 'toast-enter';
            toast.style.cssText = 'pointer-events:auto;display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:12px;border:1px solid ' + c.border + ';background:' + c.bg + ';color:' + c.text + ';font-size:14px;font-weight:500;font-family:var(--pp-ff);box-shadow:0 4px 16px rgba(0,0,0,0.3);backdrop-filter:blur(8px);';
            toast.innerHTML = '<span style="font-size:16px;flex-shrink:0;">' + c.icon + '</span><span style="flex:1;">' + message + '</span><button onclick="this.parentElement.remove()" style="background:none;border:none;color:' + c.text + ';cursor:pointer;font-size:16px;opacity:0.6;padding:0 2px;">&times;</button>';

            container.appendChild(toast);
            setTimeout(function() {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-leave');
                setTimeout(function() { toast.remove(); }, 300);
            }, duration);
        }

        // Modal
        function openModal(url) {
            htmx.ajax('GET', url, {target: '#modal-content', swap: 'innerHTML'}).then(function() {
                window.dispatchEvent(new CustomEvent('open-modal'));
            });
        }
        function closeModal() { window.dispatchEvent(new CustomEvent('close-modal')); }

        // Copy to clipboard
        function copyToClipboard(text, label) {
            navigator.clipboard.writeText(text).then(function() {
                showToast((label || 'Text') + ' kopiert', 'success');
            }).catch(function() {
                var ta = document.createElement('textarea');
                ta.value = text; ta.style.cssText = 'position:fixed;opacity:0;';
                document.body.appendChild(ta); ta.select(); document.execCommand('copy');
                document.body.removeChild(ta);
                showToast((label || 'Text') + ' kopiert', 'success');
            });
        }

        // Quick-Add Slide-Over
        var _quickAddTitles = {
            kandidat: 'Neuer Kandidat', unternehmen: 'Neues Unternehmen', kontakt: 'Neuer Kontakt',
            job: 'Neuer Job', stelle: 'Neue Stelle', aufgabe: 'Neue Aufgabe',
        };

        function openQuickAdd(type, params) {
            var overlay = document.getElementById('quickadd-overlay');
            var backdrop = document.getElementById('quickadd-backdrop');
            var panel = document.getElementById('quickadd-panel');
            var title = document.getElementById('quickadd-title');
            var content = document.getElementById('quickadd-content');

            title.textContent = _quickAddTitles[type] || 'Neu erstellen';
            content.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:200px;"><div style="width:28px;height:28px;border:2px solid var(--pp-accent);border-top-color:transparent;border-radius:50%;animation:spin .6s linear infinite;"></div></div>';

            overlay.style.display = '';
            requestAnimationFrame(function() { backdrop.style.opacity = '1'; });
            panel.classList.remove('quickadd-panel-leave');
            panel.classList.add('quickadd-panel-enter');
            document.body.style.overflow = 'hidden';

            var fetchUrl = '/partials/quickadd-' + type;
            if (params) {
                var qs = new URLSearchParams(params).toString();
                if (qs) fetchUrl += '?' + qs;
            }
            fetch(fetchUrl)
                .then(function(res) { if (!res.ok) throw new Error('HTTP ' + res.status); return res.text(); })
                .then(function(html) {
                    content.innerHTML = html;
                    var scripts = content.querySelectorAll('script');
                    scripts.forEach(function(oldScript) {
                        var newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        oldScript.parentNode.replaceChild(newScript, oldScript);
                    });
                    if (window.Alpine) Alpine.initTree(content);
                })
                .catch(function(err) {
                    content.innerHTML = '<div style="padding:40px;text-align:center;color:var(--pp-red);"><p style="font-weight:600;">Fehler beim Laden</p><p style="font-size:13px;margin-top:4px;color:var(--pp-textDim);">' + err.message + '</p></div>';
                });

            document.addEventListener('keydown', _quickAddEscHandler);
        }

        function closeQuickAdd() {
            var overlay = document.getElementById('quickadd-overlay');
            var backdrop = document.getElementById('quickadd-backdrop');
            var panel = document.getElementById('quickadd-panel');
            backdrop.style.opacity = '0';
            panel.classList.remove('quickadd-panel-enter');
            panel.classList.add('quickadd-panel-leave');
            document.body.style.overflow = '';
            setTimeout(function() {
                overlay.style.display = 'none';
                document.getElementById('quickadd-content').innerHTML = '';
            }, 300);
            document.removeEventListener('keydown', _quickAddEscHandler);
        }

        function _quickAddEscHandler(e) { if (e.key === 'Escape') closeQuickAdd(); }

        // HTMX Events
        document.body.addEventListener('showToast', function(evt) {
            showToast(evt.detail.message, evt.detail.type || 'success');
        });
        document.body.addEventListener('htmx:afterSwap', function(evt) {
            if (evt.detail.target.id === 'health-indicator') { /* handled by partial */ }
        });

        // Global Search
        function globalSearch() {
            return {
                q: '', focused: false, open: false, loading: false, results: null, noResults: false,
                async search() {
                    if (this.q.length < 2) { this.open = false; this.results = null; return; }
                    this.loading = true; this.open = true; this.noResults = false;
                    try {
                        var resp = await fetch('/api/search/global?q=' + encodeURIComponent(this.q));
                        if (resp.ok) {
                            this.results = await resp.json();
                            var total = 0;
                            for (var k in this.results) { if (Array.isArray(this.results[k])) total += this.results[k].length; }
                            this.noResults = total === 0;
                        }
                    } catch(e) { this.noResults = true; }
                    this.loading = false;
                }
            };
        }
    </script>

    <!-- Bottom Page Switcher -->
    <div class="hidden sm:flex" style="position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:var(--pp-surface);border:1px solid var(--pp-border);border-radius:50px;padding:3px;display:flex;gap:2px;box-shadow:0 4px 16px rgba(0,0,0,0.5);z-index:500;">
        <a href="/" style="padding:6px 14px;border-radius:50px;border:none;background:{% if request.url.path == '/' %}var(--pp-accent){% else %}transparent{% endif %};color:{% if request.url.path == '/' %}#fff{% else %}var(--pp-text4){% endif %};font-size:12px;font-weight:600;font-family:var(--pp-ff);text-decoration:none;transition:all .1s;display:inline-block;" onmouseover="{% if request.url.path != '/' %}this.style.color='var(--pp-textMuted)'{% endif %}" onmouseout="{% if request.url.path != '/' %}this.style.color='var(--pp-text4)'{% endif %}">Dashboard</a>
        <a href="/ats/todos/dashboard" style="padding:6px 14px;border-radius:50px;border:none;background:{% if request.url.path.startswith('/ats/todos') %}var(--pp-accent){% else %}transparent{% endif %};color:{% if request.url.path.startswith('/ats/todos') %}#fff{% else %}var(--pp-text4){% endif %};font-size:12px;font-weight:600;font-family:var(--pp-ff);text-decoration:none;transition:all .1s;display:inline-block;" onmouseover="{% if not request.url.path.startswith('/ats/todos') %}this.style.color='var(--pp-textMuted)'{% endif %}" onmouseout="{% if not request.url.path.startswith('/ats/todos') %}this.style.color='var(--pp-text4)'{% endif %}">Aufgaben</a>
        <a href="/ats" style="padding:6px 14px;border-radius:50px;border:none;background:{% if request.url.path == '/ats' %}var(--pp-accent){% else %}transparent{% endif %};color:{% if request.url.path == '/ats' %}#fff{% else %}var(--pp-text4){% endif %};font-size:12px;font-weight:600;font-family:var(--pp-ff);text-decoration:none;transition:all .1s;display:inline-block;" onmouseover="{% if request.url.path != '/ats' %}this.style.color='var(--pp-textMuted)'{% endif %}" onmouseout="{% if request.url.path != '/ats' %}this.style.color='var(--pp-text4)'{% endif %}">Pipeline</a>
        <a href="/match-center" style="padding:6px 14px;border-radius:50px;border:none;background:{% if request.url.path.startswith('/match-center') %}var(--pp-accent){% else %}transparent{% endif %};color:{% if request.url.path.startswith('/match-center') %}#fff{% else %}var(--pp-text4){% endif %};font-size:12px;font-weight:600;font-family:var(--pp-ff);text-decoration:none;transition:all .1s;display:inline-block;" onmouseover="{% if not request.url.path.startswith('/match-center') %}this.style.color='var(--pp-textMuted)'{% endif %}" onmouseout="{% if not request.url.path.startswith('/match-center') %}this.style.color='var(--pp-text4)'{% endif %}">Match Center</a>
        <a href="/action-board" style="padding:6px 14px;border-radius:50px;border:none;background:{% if request.url.path == '/action-board' %}var(--pp-accent){% else %}transparent{% endif %};color:{% if request.url.path == '/action-board' %}#fff{% else %}var(--pp-text4){% endif %};font-size:12px;font-weight:600;font-family:var(--pp-ff);text-decoration:none;transition:all .1s;display:inline-block;" onmouseover="{% if request.url.path != '/action-board' %}this.style.color='var(--pp-textMuted)'{% endif %}" onmouseout="{% if request.url.path != '/action-board' %}this.style.color='var(--pp-text4)'{% endif %}">Action Board</a>
        <a href="/kandidaten" style="padding:6px 14px;border-radius:50px;border:none;background:{% if request.url.path.startswith('/kandidaten') %}var(--pp-accent){% else %}transparent{% endif %};color:{% if request.url.path.startswith('/kandidaten') %}#fff{% else %}var(--pp-text4){% endif %};font-size:12px;font-weight:600;font-family:var(--pp-ff);text-decoration:none;transition:all .1s;display:inline-block;" onmouseover="{% if not request.url.path.startswith('/kandidaten') %}this.style.color='var(--pp-textMuted)'{% endif %}" onmouseout="{% if not request.url.path.startswith('/kandidaten') %}this.style.color='var(--pp-text4)'{% endif %}">Kandidaten</a>
    </div>

    {% block scripts %}{% endblock %}
</body>
</html>
