{# Import Dialog - CSV-Import Modal #}
{# Wird via openModal('/partials/import-dialog') geladen #}

<form id="import-form"
      x-data="{ uploading: false, fileName: '', dragging: false }"
      hx-post="/api/jobs/import"
      hx-encoding="multipart/form-data"
      hx-target="#import-status"
      hx-swap="innerHTML"
      @htmx:before-request.window="uploading = true"
      @htmx:after-request.window="uploading = false">

    <div style="padding:24px;">
        <div style="display:flex;align-items:flex-start;gap:16px;">
            <div style="width:44px;height:44px;border-radius:50%;background:rgba(99,102,241,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                <svg style="width:22px;height:22px;color:var(--pp-primary);" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                </svg>
            </div>
            <div style="flex:1;">
                <h3 style="font-size:16px;font-weight:600;color:var(--pp-text);margin:0;">Jobs importieren</h3>
                <p style="font-size:13px;color:var(--pp-text-muted);margin:6px 0 0;">
                    Laden Sie eine CSV-Datei (Tab-getrennt) mit Stellenausschreibungen hoch.
                    Maximal 10.000 Zeilen, 50 MB.
                </p>
            </div>
        </div>

        {# File Input #}
        <div style="margin-top:20px;">
            <div @dragover.prevent="dragging = true"
                 @dragleave.prevent="dragging = false"
                 @drop.prevent="dragging = false; fileName = $event.dataTransfer.files[0]?.name || ''; $refs.fileInput.files = $event.dataTransfer.files"
                 :style="dragging ? 'border-color: var(--pp-primary); background: rgba(99,102,241,0.05)' : ''"
                 style="display:flex;justify-content:center;border-radius:12px;border:2px dashed var(--pp-border);padding:40px 24px;transition:all 0.2s;">
                <div style="text-align:center;">
                    <svg style="margin:0 auto;width:48px;height:48px;color:var(--pp-text-muted);opacity:0.4;" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    <div style="margin-top:16px;display:flex;font-size:13px;color:var(--pp-text-muted);justify-content:center;">
                        <label for="csv-file"
                               style="cursor:pointer;font-weight:600;color:var(--pp-primary);">
                            <span>Datei auswaehlen</span>
                            <input id="csv-file"
                                   name="file"
                                   type="file"
                                   accept=".csv,.txt,.tsv"
                                   x-ref="fileInput"
                                   @change="fileName = $event.target.files[0]?.name || ''"
                                   style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);"
                                   required>
                        </label>
                        <span style="padding-left:4px;">oder per Drag & Drop</span>
                    </div>
                    <p style="font-size:12px;color:var(--pp-text-muted);margin-top:4px;">CSV, TSV oder TXT bis 50 MB</p>
                    <p x-show="fileName"
                       x-text="'Ausgewaehlt: ' + fileName"
                       style="margin-top:10px;font-size:13px;font-weight:600;color:var(--pp-primary);"></p>
                </div>
            </div>
        </div>

        {# Import Status — wird durch HTMX-Response ersetzt #}
        <div id="import-status" style="margin-top:16px;">
            {# Sofort-Feedback waehrend Upload #}
            <div x-show="uploading" x-cloak
                 style="border-radius:10px;background:rgba(99,102,241,0.08);border:1px solid rgba(99,102,241,0.2);padding:16px;">
                <div style="display:flex;align-items:center;gap:12px;">
                    <svg style="width:20px;height:20px;color:var(--pp-primary);animation:spin 1s linear infinite;flex-shrink:0;" viewBox="0 0 24 24">
                        <circle style="opacity:0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                        <path style="opacity:0.75;" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <div>
                        <p style="font-size:14px;font-weight:600;color:var(--pp-primary);margin:0;">Import wird verarbeitet...</p>
                        <p style="font-size:12px;color:var(--pp-text-muted);margin:4px 0 0;">
                            Datei wird hochgeladen und verarbeitet. Das kann bei grossen Dateien einige Sekunden dauern.
                        </p>
                    </div>
                </div>
                {# Animated progress bar #}
                <div style="margin-top:12px;height:4px;border-radius:2px;background:rgba(99,102,241,0.15);overflow:hidden;">
                    <div style="height:100%;width:30%;border-radius:2px;background:var(--pp-primary);animation:indeterminate 1.5s ease-in-out infinite;"></div>
                </div>
            </div>
        </div>
    </div>

    {# Footer mit Buttons — INNERHALB des Forms #}
    <div style="padding:16px 24px;border-top:1px solid var(--pp-border);display:flex;justify-content:flex-end;gap:10px;">
        <button type="button"
                onclick="closeModal()"
                :disabled="uploading"
                :style="uploading ? 'opacity:0.5;cursor:not-allowed;' : ''"
                style="padding:8px 16px;font-size:13px;font-weight:500;color:var(--pp-text-muted);background:var(--pp-surface-hover);border:1px solid var(--pp-border);border-radius:8px;cursor:pointer;">
            Abbrechen
        </button>
        <button type="submit"
                :disabled="uploading"
                :style="uploading ? 'opacity:0.6;cursor:not-allowed;' : ''"
                style="padding:8px 20px;font-size:13px;font-weight:600;color:#fff;background:var(--pp-primary);border:none;border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;">
            <template x-if="uploading">
                <svg style="width:16px;height:16px;animation:spin 1s linear infinite;" viewBox="0 0 24 24">
                    <circle style="opacity:0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                    <path style="opacity:0.75;" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </template>
            <span x-text="uploading ? 'Importiere...' : 'Importieren'"></span>
        </button>
    </div>
</form>

<style>
@keyframes indeterminate {
    0% { transform: translateX(-100%); }
    50% { transform: translateX(200%); }
    100% { transform: translateX(-100%); }
}
</style>
