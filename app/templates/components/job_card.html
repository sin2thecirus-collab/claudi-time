{# Job Card - Einzelner Job in der Liste #}
{# Verwendung: {% include 'components/job_card.html' %} #}
{# Parameter: job (Job-Objekt) #}

<div class="bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow duration-200"
     id="job-{{ job.id }}">
    <div class="p-4">
        <div class="flex items-start justify-between">
            {# Checkbox + Content #}
            <div class="flex items-start space-x-3 flex-1 min-w-0">
                <input type="checkbox"
                       name="selected_jobs"
                       value="{{ job.id }}"
                       class="mt-1 h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500">

                <div class="flex-1 min-w-0">
                    {# Position (Link zum Detail) #}
                    <a href="/jobs/{{ job.id }}"
                       class="text-base font-semibold text-gray-900 hover:text-primary-600 truncate block">
                        {{ job.position | default('Keine Position') }}
                    </a>

                    {# Unternehmen & Standort #}
                    <div class="mt-1 flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-gray-500">
                        {% if job.company_name %}
                        <span class="flex items-center">
                            <svg class="h-4 w-4 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
                            </svg>
                            {{ job.company_name }}
                        </span>
                        {% endif %}

                        {% if job.city or job.work_location_city %}
                        <span class="flex items-center">
                            <svg class="h-4 w-4 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                            </svg>
                            {{ job.work_location_city or job.city }}
                        </span>
                        {% endif %}

                        {% if job.employment_type %}
                        <span class="inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-600">
                            {{ job.employment_type }}
                        </span>
                        {% endif %}
                    </div>

                    {# Kandidaten-Info #}
                    <div class="mt-2 flex items-center space-x-4">
                        {% if job.active_candidate_count is not none and job.active_candidate_count is defined %}
                        <span class="inline-flex items-center text-sm {% if job.active_candidate_count > 0 %}text-green-600{% else %}text-gray-400{% endif %}">
                            <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                            </svg>
                            {{ job.active_candidate_count }} aktive Kandidaten
                        </span>
                        {% endif %}

                        {% if job.total_candidate_count is defined and job.total_candidate_count is not none and job.total_candidate_count > (job.active_candidate_count | default(0)) %}
                        <span class="text-sm text-gray-400">
                            ({{ job.total_candidate_count }} gesamt)
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            {# Aktionen #}
            <div class="flex items-center space-x-2 ml-4">
                {# Extern oeffnen #}
                {% if job.job_url %}
                <a href="{{ job.job_url }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="p-2 text-gray-400 hover:text-gray-600 rounded-md hover:bg-gray-100"
                   title="Extern oeffnen">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                    </svg>
                </a>
                {% endif %}

                {# Ansehen #}
                <a href="/jobs/{{ job.id }}"
                   class="p-2 text-gray-400 hover:text-primary-600 rounded-md hover:bg-gray-100"
                   title="Details ansehen">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </a>

                {# Loeschen #}
                <button type="button"
                        onclick="openModal('/api/jobs/{{ job.id }}/delete-dialog')"
                        class="p-2 text-gray-400 hover:text-red-600 rounded-md hover:bg-gray-100"
                        title="Loeschen">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                    </svg>
                </button>
            </div>
        </div>

        {# Import-Zeitstempel #}
        {% if job.imported_at is defined and job.imported_at is not none %}
        <div class="mt-2 flex items-center space-x-3 text-xs text-gray-400">
            <span title="Importiert: {{ job.imported_at.strftime('%d.%m.%Y %H:%M') }}">
                Importiert {{ job.imported_at.strftime('%d.%m.%Y') }}
            </span>
            {% if job.last_updated_at is defined and job.last_updated_at is not none %}
            <span class="text-blue-400" title="Zuletzt aktualisiert: {{ job.last_updated_at.strftime('%d.%m.%Y %H:%M') }}">
                &middot; Aktualisiert {{ job.last_updated_at.strftime('%d.%m.%Y') }}
            </span>
            {% endif %}
        </div>
        {% endif %}

        {# Ablaufdatum #}
        {% if job.expires_at %}
        <div class="mt-3 pt-3 border-t border-gray-100">
            {% set days_until_expiry = (job.expires_at - now()).days %}
            <span class="text-xs {% if days_until_expiry <= 7 %}text-red-600{% elif days_until_expiry <= 14 %}text-yellow-600{% else %}text-gray-500{% endif %}">
                {% if days_until_expiry < 0 %}
                Abgelaufen vor {{ (-days_until_expiry) }} Tagen
                {% elif days_until_expiry == 0 %}
                Laeuft heute ab
                {% elif days_until_expiry == 1 %}
                Laeuft morgen ab
                {% else %}
                Laeuft ab in {{ days_until_expiry }} Tagen
                {% endif %}
            </span>
        </div>
        {% endif %}
    </div>
</div>
