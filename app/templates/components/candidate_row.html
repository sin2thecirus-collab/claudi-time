{# Candidate Row - Kandidat in der Liste (z.B. auf Job-Detail-Seite) #}
{# Verwendung: {% include 'components/candidate_row.html' %} #}
{# Parameter: candidate (Kandidat-Objekt mit Match-Daten) #}

<div class="bg-white border border-gray-200 rounded-lg hover:shadow-sm transition-shadow duration-200"
     id="candidate-{{ candidate.id }}">
    <div class="p-4">
        <div class="flex items-start justify-between">
            {# Checkbox + Content #}
            <div class="flex items-start space-x-3 flex-1 min-w-0">
                <input type="checkbox"
                       name="selected_candidates"
                       value="{{ candidate.id }}"
                       class="mt-1 h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500">

                <div class="flex-1 min-w-0">
                    {# Name (Link zum Detail) #}
                    <a href="/kandidaten/{{ candidate.id }}"
                       class="text-base font-semibold text-gray-900 hover:text-primary-600">
                        {{ candidate.full_name or (candidate.first_name ~ ' ' ~ candidate.last_name) | default('Unbekannt') }}
                    </a>

                    {# Position & Standort #}
                    <div class="mt-1 flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-gray-500">
                        {% if candidate.current_position %}
                        <span class="flex items-center">
                            <svg class="h-4 w-4 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0M12 12.75h.008v.008H12v-.008z" />
                            </svg>
                            {{ candidate.current_position }}
                        </span>
                        {% endif %}

                        {% if candidate.city %}
                        <span class="flex items-center">
                            <svg class="h-4 w-4 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                            </svg>
                            {{ candidate.city }}
                        </span>
                        {% endif %}
                    </div>

                    {# Match-Informationen #}
                    {% if candidate.distance_km is defined and candidate.distance_km is not none %}
                    <div class="mt-2 flex flex-wrap items-center gap-3">
                        {# Distanz #}
                        <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium
                                     {% if candidate.distance_km <= 5 %}bg-green-100 text-green-700
                                     {% elif candidate.distance_km <= 15 %}bg-yellow-100 text-yellow-700
                                     {% else %}bg-gray-100 text-gray-700{% endif %}">
                            <svg class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                            </svg>
                            {{ candidate.distance_km | round(1) }} km
                        </span>

                        {# Keyword-Score #}
                        {% if candidate.keyword_score is defined and candidate.keyword_score is not none %}
                        <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium bg-blue-100 text-blue-700">
                            {{ (candidate.keyword_score * 100) | round | int }}% Keywords
                        </span>
                        {% endif %}

                        {# KI-Score #}
                        {% if candidate.ai_score is defined and candidate.ai_score is not none %}
                        <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium
                                     {% if candidate.ai_score >= 0.7 %}bg-green-100 text-green-700
                                     {% elif candidate.ai_score >= 0.4 %}bg-yellow-100 text-yellow-700
                                     {% else %}bg-red-100 text-red-700{% endif %}">
                            <svg class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456z" />
                            </svg>
                            {{ (candidate.ai_score * 100) | round | int }}% KI
                        </span>
                        {% endif %}

                        {# Status #}
                        {% if candidate.status %}
                        {% set status_colors = {
                            'new': 'bg-gray-100 text-gray-700',
                            'ai_checked': 'bg-blue-100 text-blue-700',
                            'presented': 'bg-purple-100 text-purple-700',
                            'rejected': 'bg-red-100 text-red-700',
                            'placed': 'bg-green-100 text-green-700'
                        } %}
                        {% set status_labels = {
                            'new': 'Neu',
                            'ai_checked': 'KI-geprueft',
                            'presented': 'Vorgestellt',
                            'rejected': 'Abgelehnt',
                            'placed': 'Vermittelt'
                        } %}
                        <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium {{ status_colors[candidate.status] | default('bg-gray-100 text-gray-700') }}">
                            {{ status_labels[candidate.status] | default(candidate.status) }}
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}

                    {# Skills (erste 5) #}
                    {% if candidate.skills and candidate.skills | length > 0 %}
                    <div class="mt-2 flex flex-wrap gap-1">
                        {% for skill in candidate.skills[:5] %}
                        <span class="inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">
                            {{ skill }}
                        </span>
                        {% endfor %}
                        {% if candidate.skills | length > 5 %}
                        <span class="inline-flex items-center text-xs text-gray-400">
                            +{{ candidate.skills | length - 5 }} weitere
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>

            {# Aktionen #}
            <div class="flex items-center space-x-2 ml-4">
                {# CV anzeigen (Sidebar via Proxy-Endpoint) #}
                {% if candidate.cv_url %}
                <button type="button"
                        onclick="openCvSidebar('/api/candidates/{{ candidate.id }}/cv-preview', '{{ (candidate.full_name or (candidate.first_name ~ ' ' ~ candidate.last_name)) | default('Kandidat') | e }}')"
                        class="p-2 text-gray-400 hover:text-gray-600 rounded-md hover:bg-gray-100"
                        title="Lebenslauf ansehen">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                </button>
                {% endif %}


                {# Details ansehen #}
                <a href="/kandidaten/{{ candidate.id }}"
                   class="p-2 text-gray-400 hover:text-primary-600 rounded-md hover:bg-gray-100"
                   title="Details ansehen">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </a>
            </div>
        </div>
    </div>
</div>
