<!-- Quick-Add Unternehmen -->
<div x-data="{
    saving: false,
    form: {
        name: '',
        address: '',
        city: '',
        domain: '',
        phone: '',
        employee_count: '',
        notes: '',
    },

    async save() {
        if (!this.form.name.trim()) {
            showToast('Bitte Unternehmensnamen eingeben', 'warning');
            return;
        }

        this.saving = true;

        const payload = {};
        for (const [key, val] of Object.entries(this.form)) {
            payload[key] = val.trim() || null;
        }

        try {
            const res = await fetch('/api/companies', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });

            if (!res.ok) {
                const err = await res.json().catch(() => null);
                throw new Error(err?.detail || 'HTTP ' + res.status);
            }

            const result = await res.json();
            showToast('Unternehmen ' + (result.name || payload.name) + ' erstellt!', 'success');
            closeQuickAdd();

            setTimeout(() => {
                window.location.href = '/unternehmen/' + result.id;
            }, 500);
        } catch (err) {
            showToast('Fehler: ' + err.message, 'error');
            this.saving = false;
        }
    }
}" class="p-6 space-y-5">

    <!-- Name (Pflicht) -->
    <div>
        <label class="block text-xs font-medium text-gray-600 mb-1">Unternehmenname *</label>
        <input type="text" x-model="form.name" placeholder="z.B. Mustermann GmbH" autofocus
               class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm">
    </div>

    <!-- Adresse -->
    <fieldset class="space-y-3">
        <legend class="text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 0115 0z" /></svg>
            Adresse
        </legend>
        <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Adresse</label>
            <textarea x-model="form.address" rows="2" placeholder="z.B. Musterstr. 1, 80331 Muenchen"
                      class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"></textarea>
        </div>
        <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Stadt</label>
            <input type="text" x-model="form.city" placeholder="Stadt"
                   class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm">
        </div>
    </fieldset>

    <!-- Kontakt & Details -->
    <fieldset class="space-y-3">
        <legend class="text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418" /></svg>
            Kontakt &amp; Details
        </legend>
        <div class="grid grid-cols-2 gap-3">
            <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Website / Domain</label>
                <input type="text" x-model="form.domain" placeholder="beispiel.de"
                       class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Telefon Zentrale</label>
                <input type="text" x-model="form.phone" placeholder="+49 69 12345678"
                       class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm">
            </div>
        </div>
        <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Mitarbeiteranzahl</label>
            <input type="text" x-model="form.employee_count" placeholder="z.B. 50-100"
                   class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm">
        </div>
    </fieldset>

    <!-- Notizen -->
    <div>
        <label class="block text-xs font-medium text-gray-600 mb-1">Notizen</label>
        <textarea x-model="form.notes" rows="3" placeholder="Interne Notizen..."
                  class="w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"></textarea>
    </div>

    <!-- Buttons -->
    <div class="pt-4 border-t border-gray-200 flex gap-3">
        <button @click="save()"
                :disabled="saving"
                class="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-semibold text-sm transition-colors disabled:opacity-60 disabled:cursor-not-allowed">
            <template x-if="!saving">
                <span class="flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>
                    Unternehmen erstellen
                </span>
            </template>
            <template x-if="saving">
                <span class="flex items-center gap-2">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                    Wird erstellt...
                </span>
            </template>
        </button>
        <button @click="closeQuickAdd()"
                class="px-4 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium text-sm hover:bg-gray-50 transition-colors">
            Abbrechen
        </button>
    </div>
</div>
