{# Undo Toast - Mit Rueckgaengig-Option #}
{# Verwendung: {% include 'components/undo_toast.html' %} #}
{# Parameter: message, undo_url, undo_method (default 'POST'), timeout (ms, default 10000) #}
{% set message = message | default('Aktion ausgefuehrt') %}
{% set undo_method = undo_method | default('POST') %}
{% set timeout = timeout | default(10000) %}

<div id="undo-toast-{{ range(10000) | random }}"
     class="pointer-events-auto flex items-center justify-between rounded-lg border border-gray-200 bg-white p-4 shadow-lg toast-enter"
     hx-swap-oob="beforeend:#toast-container"
     x-data="{ countdown: {{ (timeout / 1000) | int }}, interval: null }"
     x-init="interval = setInterval(() => { countdown--; if(countdown <= 0) { clearInterval(interval); $el.classList.add('toast-leave'); setTimeout(() => $el.remove(), 300); } }, 1000)">

    <div class="flex items-center space-x-3">
        <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
        </svg>
        <p class="text-sm font-medium text-gray-900">{{ message }}</p>
    </div>

    <div class="flex items-center space-x-4 ml-4">
        <span class="text-xs text-gray-400" x-text="countdown + 's'"></span>
        {% if undo_url %}
        <button type="button"
                hx-{{ undo_method | lower }}="{{ undo_url }}"
                hx-swap="none"
                @click="clearInterval(interval); $el.closest('[id^=undo-toast]').classList.add('toast-leave'); setTimeout(() => $el.closest('[id^=undo-toast]').remove(), 300)"
                class="text-sm font-semibold text-primary-600 hover:text-primary-500">
            Rueckgaengig
        </button>
        {% endif %}
        <button type="button"
                @click="clearInterval(interval); $el.closest('[id^=undo-toast]').classList.add('toast-leave'); setTimeout(() => $el.closest('[id^=undo-toast]').remove(), 300)"
                class="text-gray-400 hover:text-gray-500">
            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"/>
            </svg>
        </button>
    </div>
</div>
