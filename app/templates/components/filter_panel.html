{# Filter Panel - Ausklappbares Filter-UI #}
{# Verwendung: {% include 'components/filter_panel.html' %} #}
{# Parameter: filters (aktuelle Filter), options (verfuegbare Optionen), filter_url, target_id #}
{% set filter_url = filter_url | default('/api/jobs') %}
{% set target_id = target_id | default('#job-list') %}

<div x-data="{ open: false }" class="bg-white border border-gray-200 rounded-lg mb-4">
    {# Header #}
    <button @click="open = !open"
            type="button"
            class="w-full flex items-center justify-between px-4 py-3 text-left">
        <div class="flex items-center space-x-2">
            <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" />
            </svg>
            <span class="font-medium text-gray-900">Filter</span>
            {% if filters and (filters.cities or filters.skills or filters.position) %}
            <span class="inline-flex items-center rounded-full bg-primary-100 px-2 py-0.5 text-xs font-medium text-primary-700">
                Aktiv
            </span>
            {% endif %}
        </div>
        <svg :class="{ 'rotate-180': open }"
             class="h-5 w-5 text-gray-400 transition-transform duration-200"
             fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
        </svg>
    </button>

    {# Filter Content #}
    <div x-show="open"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 -translate-y-2"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 -translate-y-2"
         class="border-t border-gray-200 px-4 py-4"
         style="display: none;">

        <form hx-get="{{ filter_url }}"
              hx-target="{{ target_id }}"
              hx-push-url="true"
              hx-trigger="change delay:300ms, submit"
              class="space-y-4">

            {# Suchfeld #}
            <div>
                <label for="search" class="block text-sm font-medium text-gray-700">Suche</label>
                <div class="mt-1 relative">
                    <input type="text"
                           name="search"
                           id="search"
                           value="{{ filters.search | default('') }}"
                           placeholder="Position, Unternehmen..."
                           class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm pl-10">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
                {# Stadt-Filter #}
                {% if options and options.cities %}
                <div>
                    <label for="cities" class="block text-sm font-medium text-gray-700">Stadt</label>
                    <select name="cities"
                            id="cities"
                            multiple
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"
                            size="4">
                        {% for city in options.cities %}
                        <option value="{{ city }}"
                                {% if filters.cities and city in filters.cities %}selected{% endif %}>
                            {{ city }}
                        </option>
                        {% endfor %}
                    </select>
                    <p class="mt-1 text-xs text-gray-500">Strg/Cmd + Klick fuer Mehrfachauswahl</p>
                </div>
                {% endif %}

                {# Skills-Filter #}
                {% if options and options.skills %}
                <div>
                    <label for="skills" class="block text-sm font-medium text-gray-700">Skills</label>
                    <select name="skills"
                            id="skills"
                            multiple
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"
                            size="4">
                        {% for skill in options.skills %}
                        <option value="{{ skill }}"
                                {% if filters.skills and skill in filters.skills %}selected{% endif %}>
                            {{ skill }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}

                {# Branchen-Filter #}
                {% if options and options.industries %}
                <div>
                    <label for="industry" class="block text-sm font-medium text-gray-700">Branche</label>
                    <select name="industry"
                            id="industry"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                        <option value="">Alle Branchen</option>
                        {% for industry in options.industries %}
                        <option value="{{ industry }}"
                                {% if filters.industry == industry %}selected{% endif %}>
                            {{ industry }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}

                {# Sortierung #}
                <div>
                    <label for="sort_by" class="block text-sm font-medium text-gray-700">Sortierung</label>
                    <select name="sort_by"
                            id="sort_by"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                        <option value="created_at" {% if filters.sort_by == 'created_at' %}selected{% endif %}>Neueste zuerst</option>
                        <option value="position" {% if filters.sort_by == 'position' %}selected{% endif %}>Position A-Z</option>
                        <option value="company_name" {% if filters.sort_by == 'company_name' %}selected{% endif %}>Unternehmen A-Z</option>
                        <option value="candidate_count" {% if filters.sort_by == 'candidate_count' %}selected{% endif %}>Meiste Kandidaten</option>
                    </select>
                </div>
            </div>

            {# Checkboxen #}
            <div class="flex flex-wrap gap-4">
                <label class="inline-flex items-center">
                    <input type="checkbox"
                           name="has_active_candidates"
                           value="true"
                           {% if filters.has_active_candidates %}checked{% endif %}
                           class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                    <span class="ml-2 text-sm text-gray-700">Nur mit aktiven Kandidaten</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="checkbox"
                           name="include_expired"
                           value="true"
                           {% if filters.include_expired %}checked{% endif %}
                           class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                    <span class="ml-2 text-sm text-gray-700">Abgelaufene einschliessen</span>
                </label>
            </div>

            {# Aktionen #}
            <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                <button type="button"
                        onclick="this.closest('form').reset(); htmx.trigger(this.closest('form'), 'submit')"
                        class="text-sm font-medium text-gray-500 hover:text-gray-700">
                    Filter zuruecksetzen
                </button>
                <button type="submit"
                        class="inline-flex items-center rounded-md bg-primary-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500">
                    Anwenden
                </button>
            </div>
        </form>
    </div>
</div>
