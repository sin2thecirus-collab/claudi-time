{% extends "base.html" %}

{% block title %}Match-Bereiche {{ category_label }} — Pulspoint{% endblock %}

{% block content %}
<div class="space-y-6" x-data="matchBereiche()">
    {# ═══ Header ═══ #}
    <div>
        <nav class="flex mb-2" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2 text-sm text-gray-500">
                <li><a href="/hotlisten" class="hover:text-primary-600 transition-colors">Hotlisten</a></li>
                <li><span class="mx-1">/</span></li>
                <li class="font-medium text-gray-900">{{ category_label }}</li>
            </ol>
        </nav>
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="/hotlisten" class="inline-flex items-center justify-center w-10 h-10 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                    </svg>
                </a>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Match-Bereiche</h1>
                    <p class="text-base text-gray-500 mt-0.5">Beruf &rarr; Stadt &rarr; Quick Match &rarr; Ergebnisse</p>
                </div>
            </div>
            <div class="flex items-center gap-2 bg-gray-100 rounded-lg p-1">
                <a href="/match-bereiche?category=FINANCE"
                   class="rounded-md px-5 py-2.5 text-base font-medium transition-all {% if category == 'FINANCE' %}bg-white text-gray-900 shadow-sm{% else %}text-gray-500 hover:text-gray-700{% endif %}">
                    Finance
                </a>
                <a href="/match-bereiche?category=ENGINEERING"
                   class="rounded-md px-5 py-2.5 text-base font-medium transition-all {% if category == 'ENGINEERING' %}bg-white text-gray-900 shadow-sm{% else %}text-gray-500 hover:text-gray-700{% endif %}">
                    Engineering
                </a>
            </div>
        </div>
    </div>

    {# ═══ Stats Cards ═══ #}
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <div style="background:var(--pp-surface);border:1px solid var(--pp-border);" class="rounded-2xl px-5 py-5">
            <div class="flex items-center justify-between">
                <div>
                    <p style="color:var(--pp-accent);" class="text-sm font-medium">Kandidaten</p>
                    <p style="color:var(--pp-text);" class="text-3xl font-extrabold mt-1">{{ total_candidates }}</p>
                </div>
                <div style="background:var(--pp-accentSoft);" class="flex items-center justify-center w-12 h-12 rounded-xl">
                    <svg style="color:var(--pp-accent);" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                    </svg>
                </div>
            </div>
        </div>
        <div style="background:var(--pp-surface);border:1px solid var(--pp-border);" class="rounded-2xl px-5 py-5">
            <div class="flex items-center justify-between">
                <div>
                    <p style="color:var(--pp-green);" class="text-sm font-medium">Jobs</p>
                    <p style="color:var(--pp-text);" class="text-3xl font-extrabold mt-1">{{ total_jobs }}</p>
                </div>
                <div style="background:var(--pp-greenSoft);" class="flex items-center justify-center w-12 h-12 rounded-xl">
                    <svg style="color:var(--pp-green);" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0" />
                    </svg>
                </div>
            </div>
        </div>
        <div style="background:var(--pp-surface);border:1px solid var(--pp-border);" class="rounded-2xl px-5 py-5">
            <div class="flex items-center justify-between">
                <div>
                    <p style="color:var(--pp-purple);" class="text-sm font-medium">Berufsgruppen</p>
                    <p style="color:var(--pp-text);" class="text-3xl font-extrabold mt-1">{{ total_professions }}</p>
                </div>
                <div style="background:var(--pp-purpleSoft);" class="flex items-center justify-center w-12 h-12 rounded-xl">
                    <svg style="color:var(--pp-purple);" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25" />
                    </svg>
                </div>
            </div>
        </div>
        <div style="background:var(--pp-surface);border:1px solid var(--pp-border);" class="rounded-2xl px-5 py-5">
            <div class="flex items-center justify-between">
                <div>
                    <p style="color:var(--pp-orange);" class="text-sm font-medium">Matchbare Kombos</p>
                    <p style="color:var(--pp-text);" class="text-3xl font-extrabold mt-1">{{ total_matchable }}</p>
                </div>
                <div style="background:var(--pp-orangeSoft);" class="flex items-center justify-center w-12 h-12 rounded-xl">
                    <svg style="color:var(--pp-orange);" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
                    </svg>
                </div>
            </div>
        </div>
    </div>

    {# ═══ Suchleiste ═══ #}
    <div class="bg-white rounded-xl border border-gray-200 px-6 py-4">
        <div class="flex items-center gap-3 flex-1">
            <div class="relative flex-1 max-w-md">
                <svg class="absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
                <input type="text" x-model="searchQuery" placeholder="Beruf oder Stadt suchen..."
                       class="w-full rounded-lg border-gray-300 pl-11 pr-4 py-2.5 text-base placeholder-gray-400 focus:border-primary-500 focus:ring-primary-500">
            </div>
        </div>
    </div>

    {# ═══ Berufsliste (Beruf-zuerst) ═══ #}
    {% if combo_data %}
    <div class="space-y-4">
        {% for title, cities, total_cand, total_jobs_count in combo_data %}
        <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-300"
             x-show="professionVisible('{{ title }}', '{{ cities | map(attribute='city') | join(',') }}')"
             x-transition>

            {# ── Beruf-Header (aufklappbar) ── #}
            <button @click="toggleProfession('{{ title }}')"
                    class="w-full text-left px-6 py-5 transition-colors"
                    :class="openProfessions.includes('{{ title }}') ? '' : ''"
                    style="background: var(--pp-surface);"
                    onmouseover="this.style.background='var(--pp-surfaceHover)'"
                    onmouseout="this.style.background='var(--pp-surface)'"
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4 min-w-0">
                        <div class="flex items-center justify-center w-12 h-12 rounded-xl flex-shrink-0" style="background:var(--pp-accentSoft); border:1px solid rgba(59,130,246,0.2);"
                            <svg class="w-6 h-6" style="color:var(--pp-accent);" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0" />
                            </svg>
                        </div>
                        <div class="min-w-0">
                            <h3 class="text-xl font-bold text-gray-900 truncate">{{ title }}</h3>
                            <div class="flex items-center gap-3 mt-1">
                                <span class="text-sm text-gray-500">{{ cities | length }} Staedte</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 flex-shrink-0">
                        <div class="hidden sm:flex items-center gap-3">
                            <div class="flex items-center gap-2 bg-blue-50 rounded-full px-4 py-2">
                                <svg class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0" />
                                </svg>
                                <span class="text-sm font-bold text-blue-700">{{ total_cand }}</span>
                                <span class="text-xs text-blue-500">Kand.</span>
                            </div>
                            <div class="flex items-center gap-2 bg-green-50 rounded-full px-4 py-2">
                                <svg class="w-4 h-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25" />
                                </svg>
                                <span class="text-sm font-bold text-green-700">{{ total_jobs_count }}</span>
                                <span class="text-xs text-green-500">Jobs</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-center w-8 h-8 rounded-full"
                             :class="openProfessions.includes('{{ title }}') ? 'bg-primary-100' : 'bg-gray-100'">
                            <svg class="w-4 h-4 transition-transform duration-300"
                                 :class="openProfessions.includes('{{ title }}') ? 'rotate-180 text-primary-600' : 'text-gray-400'"
                                 fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                            </svg>
                        </div>
                    </div>
                </div>
            </button>

            {# ── Staedte-Tabelle (aufklappbar) ── #}
            <div x-show="openProfessions.includes('{{ title }}')"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 class="border-t border-gray-100">

                {# Tabellen-Header #}
                <div class="grid grid-cols-12 gap-2 px-6 py-2.5 bg-gray-50 text-xs font-semibold text-gray-500 uppercase tracking-wider">
                    <div class="col-span-4">Stadt</div>
                    <div class="col-span-2 text-center">Kandidaten</div>
                    <div class="col-span-2 text-center">Jobs</div>
                    <div class="col-span-4 text-right">Aktion</div>
                </div>

                {# Stadt-Zeilen #}
                {% for c in cities %}
                <div x-show="cityVisible('{{ c.city }}')" class="border-t border-gray-50">
                    <div class="grid grid-cols-12 gap-2 items-center px-6 py-3 hover:bg-gray-50 transition-colors">
                        <div class="col-span-4">
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                                </svg>
                                <span class="text-sm font-medium text-gray-900">{{ c.city }}</span>
                            </div>
                        </div>
                        <div class="col-span-2 text-center">
                            <span class="inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-sm font-semibold text-blue-700">{{ c.candidates }}</span>
                        </div>
                        <div class="col-span-2 text-center">
                            <span class="inline-flex items-center rounded-full bg-green-50 px-2.5 py-0.5 text-sm font-semibold text-green-700">{{ c.jobs }}</span>
                        </div>
                        <div class="col-span-4 text-right flex items-center justify-end gap-2">
                            <button @click.stop="quickMatch('{{ category }}', '{{ c.city }}', '{{ title }}')"
                                    class="inline-flex items-center gap-1.5 rounded-lg bg-primary-50 text-primary-700 hover:bg-primary-600 hover:text-white px-3 py-2 text-sm font-semibold transition-all duration-200">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
                                </svg>
                                Quick Match
                            </button>
                            <a href="/deepmatch?category={{ category }}&city={{ c.city | urlencode }}&job_title={{ title | urlencode }}"
                               class="inline-flex items-center gap-1 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 px-2.5 py-2 text-xs font-medium transition-colors"
                               title="Erweiterte Ansicht">
                                <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                                </svg>
                            </a>
                        </div>
                    </div>

                    {# Inline-Ergebnisse (wird per HTMX geladen) #}
                    <div :id="'results-{{ category }}-' + '{{ c.city }}'.replace(/\s/g, '_') + '-' + '{{ title }}'.replace(/[\s\/]/g, '_')"
                         class="bg-gray-50/50">
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-2xl border border-gray-200 px-6 py-16 text-center">
        <svg class="mx-auto h-12 w-12 text-gray-300" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
        </svg>
        <p class="mt-4 text-base font-medium text-gray-900">Keine matchbaren Kombinationen</p>
        <p class="text-sm text-gray-500 mt-1">Es gibt keine Beruf-Stadt-Kombination mit Kandidaten UND Jobs.</p>
    </div>
    {% endif %}

    {# ═══ Berufsgruppen-Statistik ═══ #}
    {% if title_data %}
    <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden">
        <div class="px-6 py-5 border-b" style="background:var(--pp-surface); border-color:var(--pp-border);"
            <div class="flex items-center gap-3">
                <div class="flex items-center justify-center w-9 h-9 rounded-lg bg-green-100">
                    <svg class="w-5 h-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75z" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-base font-bold text-gray-900">Alle Berufsgruppen</h2>
                    <p class="text-xs text-gray-400 mt-0.5">Ein Kandidat kann in mehreren Gruppen erscheinen</p>
                </div>
            </div>
        </div>
        <div class="divide-y divide-gray-100">
            {% for title in title_data %}
            <div class="flex items-center justify-between px-6 py-3.5 hover:bg-gray-50/80 transition-colors">
                <div class="flex items-center gap-3 min-w-0">
                    <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-gray-100 text-xs font-bold text-gray-500 flex-shrink-0">{{ loop.index }}</span>
                    <span class="text-sm font-medium text-gray-900 truncate">{{ title.name }}</span>
                </div>
                <div class="flex items-center gap-4 flex-shrink-0">
                    <span class="inline-flex items-center gap-1.5 text-sm font-semibold text-blue-600">
                        <span class="w-1.5 h-1.5 rounded-full bg-blue-400"></span>
                        {{ title.candidates }}
                    </span>
                    <span class="inline-flex items-center gap-1.5 text-sm font-semibold text-green-600">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-400"></span>
                        {{ title.jobs }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
function matchBereiche() {
    return {
        searchQuery: '',
        openProfessions: [
            // Fokussierter Beruf oder die ersten 2 automatisch offen
            {% if focus_title %}
            '{{ focus_title }}'
            {% else %}
            {% for title, cities, total_cand, total_jobs_count in combo_data[:2] %}
            '{{ title }}'{% if not loop.last %},{% endif %}
            {% endfor %}
            {% endif %}
        ],

        toggleProfession(title) {
            const idx = this.openProfessions.indexOf(title);
            if (idx > -1) {
                this.openProfessions.splice(idx, 1);
            } else {
                this.openProfessions.push(title);
            }
        },

        professionVisible(title, citiesStr) {
            const q = this.searchQuery.toLowerCase().trim();
            if (!q) return true;
            return title.toLowerCase().includes(q) || citiesStr.toLowerCase().includes(q);
        },

        cityVisible(city) {
            const q = this.searchQuery.toLowerCase().trim();
            if (!q) return true;
            return city.toLowerCase().includes(q);
        },

        async quickMatch(category, city, jobTitle) {
            // Target-Container fuer Inline-Ergebnisse
            const containerId = 'results-' + category + '-' + city.replace(/\s/g, '_') + '-' + jobTitle.replace(/[\s\/]/g, '_');
            const container = document.getElementById(containerId);
            if (!container) return;

            // Loading-State anzeigen
            container.innerHTML = `
                <div class="px-6 py-6 flex items-center justify-center gap-3">
                    <svg class="animate-spin h-5 w-5 text-primary-500" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                    <span class="text-sm text-gray-500">Matches werden erstellt und bewertet...</span>
                </div>
            `;

            try {
                // 1. Quick-Match starten
                const triggerResp = await fetch(
                    '/api/hotlisten/quick-match?category=' + encodeURIComponent(category) +
                    '&city=' + encodeURIComponent(city) +
                    '&job_title=' + encodeURIComponent(jobTitle),
                    { method: 'POST' }
                );
                const triggerData = await triggerResp.json();

                if (!triggerData.task_id) {
                    container.innerHTML = '<div class="px-6 py-4 text-sm text-red-500">Fehler beim Starten.</div>';
                    return;
                }

                // 2. Polling bis fertig
                const taskId = triggerData.task_id;
                let status = 'running';
                let attempts = 0;

                while (status === 'running' && attempts < 120) {
                    await new Promise(r => setTimeout(r, 1000));
                    const statusResp = await fetch('/api/hotlisten/quick-match/' + taskId + '/status');
                    const statusData = await statusResp.json();
                    status = statusData.status;

                    if (statusData.phase === 'scoring') {
                        container.innerHTML = `
                            <div class="px-6 py-6 flex items-center justify-center gap-3">
                                <svg class="animate-spin h-5 w-5 text-primary-500" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                                </svg>
                                <span class="text-sm text-gray-500">Pre-Scoring laeuft... (${statusData.matches_created || 0} Matches erstellt)</span>
                            </div>
                        `;
                    }

                    attempts++;
                }

                if (status === 'error') {
                    container.innerHTML = '<div class="px-6 py-4 text-sm text-red-500">Fehler bei der Match-Erstellung.</div>';
                    return;
                }

                // 3. Ergebnisse laden
                const resultsResp = await fetch(
                    '/partials/match-results?category=' + encodeURIComponent(category) +
                    '&city=' + encodeURIComponent(city) +
                    '&job_title=' + encodeURIComponent(jobTitle)
                );
                container.innerHTML = await resultsResp.text();

            } catch (e) {
                container.innerHTML = '<div class="px-6 py-4 text-sm text-red-500">Netzwerkfehler: ' + e.message + '</div>';
            }
        }
    };
}
</script>
{% endblock %}
